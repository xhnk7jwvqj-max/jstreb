(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function a(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=a(i);fetch(i.href,r)}})();function ce(){this.one_d_arrays=[],this.two_d_arrays=[],this.zero_time=0}ce.prototype.getVec=function(e){this.one_d_arrays[e]===void 0&&(this.one_d_arrays[e]={index:0,zero_time:this.zero_time,backing:new Array(100).fill(0).map(()=>Array(e))});var t=this.one_d_arrays[e];return t.zero_time!=this.zero_time&&(t.index=0,t.zero_time=this.zero_time),t.index+=1,t.backing[t.index-1]};ce.prototype.getMat=function(e,t){this.two_d_arrays[e]===void 0&&(this.two_d_arrays[e]=[]),this.two_d_arrays[e][t]===void 0&&(this.two_d_arrays[e][t]={index:0,zero_time:this.zero_time,backing:new Array(100).fill(0).map(()=>Array(e).fill(0).map(()=>new Array(t)))});var a=this.two_d_arrays[e][t];a.zero_time!=this.zero_time&&(a.index=0,a.zero_time=this.zero_time),a.index+=1;var n=a.backing[a.index-1];return n};ce.prototype.clear=function(){this.zero_time+=1};const D=new ce;function Re(e,t){const a=e.length,n=D.getMat(a,a);let i=D.getVec(a);for(var r=0;r<e.length;r++)i[r]=e[r][0];for(let d=0;d<a;d++){var o=e[d];for(let u=0;u<a;u++){var s=0,c=i[d]&i[u];if(c)for(var l=t[u];c;){var p=31-Math.clz32(c);c=c-(1<<p),s+=o[p+1]*l[p+1]}n[d][u]=s}}return n}function Be(e,t){const a=e.length,n=e[0].length,i=D.getMat(a,n);for(let s=0;s<a;s++){let c=i[s],l=e[s];c[0]=l[0];for(var r=c[0];r;){var o=31-Math.clz32(r);r=r-(1<<o),c[o+1]=l[o+1]/t[o]}}return i}function Oe(e,t){const a=e.length,n=e[0].length,i=D.getMat(a,n);for(let r=0;r<a;r++){let o=i[r],s=e[r];for(let c=0;c<n;c++)o[c]=s[c]/t[c]}return i}function A(e,t){return[e[0]-t[0],e[1]-t[1]]}function Ne(e,t){return new Array(e.length).fill(0).map((a,n)=>e[n]-t[n])}function Ye(e,t){const a=e.length,n=e[0].length,i=t.length,r=t[0].length-1;n!=i&&(console.log(n),console.log(i),assert(n==i));const o=new Array(a).fill(0).map(()=>new Array(r).fill(0));for(let l=0;l<a;l++)for(let p=0;p<n;p++)for(var s=t[p][0];s;){var c=31-Math.clz32(s);s=s-(1<<c),o[l][c]+=e[l][p]*t[p][c+1]}return o}function qe(e,t){const a=e.length;for(let o=0;o<a;o++){let s=Math.abs(e[o][o]),c=o;for(let d=o+1;d<a;d++)Math.abs(e[d][o])>s&&(s=Math.abs(e[d][o]),c=d);const l=e[c];e[c]=e[o],e[o]=l;const p=t[c];t[c]=t[o],t[o]=p;var n=e[o];for(let d=o+1;d<a;d++){var i=e[d];const u=-i[o]/n[o];i[o]=0;for(let h=o+1;h<a;h++)i[h]+=u*n[h];t[d]+=u*t[o]}}const r=new Array(a).fill(0);for(let o=a-1;o>-1;o--){r[o]=t[o]/e[o][o];for(let s=o-1;s>-1;s--)t[s]-=e[s][o]*r[o]}return r}function Xe(e){for(var t=0,a=0;a<e.length;a++)t=Math.max(Math.abs(e[a]),t);return t}function $e(e,t){for(var a=new Array(e.length),n=0;n<e.length;n++)a[n]=e[n]-t[n];return a}function y(e,t){for(var a=new Array(e.length),n=0;n<e.length;n++)a[n]=e[n]+t[n];return a}function g(e,t){if(Array.isArray(e)){var a=t;t=e,e=a}for(var n=new Array(t.length),i=0;i<t.length;i++)n[i]=e*t[i];return n}function he(e,t,a,n,i,r,o){this.x=e,this.y=t,this.f=a,this.ymid=n,this.iterations=i,this.events=o,this.message=r}he.prototype._at=function(m,a){function n(O){return O*O}var i=this,r=i.x,o=i.y,s=i.f,c=i.ymid;r.length;var l,p,d,u,h,x,m,$,S=.5,z,B,T;return l=r[a],p=r[a+1],u=o[a],h=o[a+1],$=p-l,d=l+S*$,x=c[a],z=$e(s[a],g(u,1/(l-d)+2/(l-p))),B=$e(s[a+1],g(h,1/(p-d)+2/(p-l))),T=[n(m-p)*(m-d)/n(l-p)/(l-d),n(m-l)*n(m-p)/n(l-d)/n(p-d),n(m-l)*(m-d)/n(p-l)/(p-d),(m-l)*n(m-p)*(m-d)/n(l-p)/(l-d),(m-p)*n(m-l)*(m-d)/n(l-p)/(p-d)],y(y(y(y(g(u,T[0]),g(x,T[1])),g(h,T[2])),g(z,T[3])),g(B,T[4]))};he.prototype.at=function(t){var a,n,i,r=Math.floor;if(typeof t!="number"){var o=t.length,s=Array(o);for(a=o-1;a!==-1;--a)s[a]=this.at(t[a]);return s}var c=this.x;for(a=0,n=c.length-1;n-a>1;)i=r(.5*(a+n)),c[i]<=t?a=i:n=i;return this._at(t,a)};function De(e,t,a,n,i,r,o){typeof i>"u"&&(i=1e-6),typeof r>"u"&&(r=1e3);var s=[e],c=[a],l=[n(e,a)],p,d,u,h,x,m,$=[],S=1/5,z=[3/40,9/40],B=[44/45,-56/15,32/9],T=[19372/6561,-25360/2187,64448/6561,-212/729],O=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],W=[35/384,0,500/1113,125/192,-2187/6784,11/84],H=[.5*6025192743/30085553152,0,.5*51252292925/65400821598,.5*-2691868925/45128329728,.5*187940372067/1594534317056,.5*-1776094331/19743644256,.5*11237099/235043384],G=[1/5,3/10,4/5,8/9,1,1],J=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],M=0,Z,j,f=(t-e)/10,ee=0,N,V,xe=Math.min,Fe=Math.abs,be=Math.pow,te=te,Y=Y,ne=ne,k,I,U,L=new he(s,c,l,$,-1,"");for(typeof o=="function"&&(k=o(e,a));e<t&&ee<r;){if(++ee,e+f>t&&(f=t-e),p=n(e+G[0]*f,y(a,g(S*f,l[M]))),d=n(e+G[1]*f,y(y(a,g(z[0]*f,l[M])),g(z[1]*f,p))),u=n(e+G[2]*f,y(y(y(a,g(B[0]*f,l[M])),g(B[1]*f,p)),g(B[2]*f,d))),h=n(e+G[3]*f,y(y(y(y(a,g(T[0]*f,l[M])),g(T[1]*f,p)),g(T[2]*f,d)),g(T[3]*f,u))),x=n(e+G[4]*f,y(y(y(y(y(a,g(O[0]*f,l[M])),g(O[1]*f,p)),g(O[2]*f,d)),g(O[3]*f,u)),g(O[4]*f,h))),N=y(y(y(y(y(a,g(l[M],f*W[0])),g(d,f*W[2])),g(u,f*W[3])),g(h,f*W[4])),g(x,f*W[5])),m=n(e+f,N),Z=y(y(y(y(y(g(l[M],f*J[0]),g(d,f*J[2])),g(u,f*J[3])),g(h,f*J[4])),g(x,f*J[5])),g(m,f*J[6])),typeof Z=="number"?V=Fe(Z):V=Xe(Z),V>i){if(f=.2*f*be(i/V,.25),e+f===e){L.msg="Step size became too small";break}continue}if($[M]=y(y(y(y(y(y(a,g(l[M],f*H[0])),g(d,f*H[2])),g(u,f*H[3])),g(h,f*H[4])),g(x,f*H[5])),g(m,f*H[6])),++M,s[M]=e+f,c[M]=N,l[M]=m,typeof o=="function"){var ae,K=e,F=e+.5*f,E;if(I=o(F,$[M-1]),U=ne(Y(k,0),Y(0,I)),te(U)||(K=F,F=e+f,k=I,I=o(F,N),U=ne(Y(k,0),Y(0,I))),te(U)){for(var pe,oe,ie=0,q=1,X=1;;){if(typeof k=="number")E=(X*I*K-q*k*F)/(X*I-q*k);else for(E=F,j=k.length-1;j!==-1;--j)k[j]<0&&I[j]>0&&(E=xe(E,(X*I[j]*K-q*k[j]*F)/(X*I[j]-q*k[j])));if(E<=K||E>=F)break;ae=L._at(E,M-1),oe=o(E,ae),pe=ne(Y(k,0),Y(0,oe)),te(pe)?(F=E,I=oe,U=pe,X=1,ie===-1?q*=.5:q=1,ie=-1):(K=E,k=oe,q=1,ie===1?X*=.5:X=1,ie=1)}return N=L._at(.5*(e+E),M-1),L.f[M]=n(E,ae),L.x[M]=E,L.y[M]=ae,L.ymid[M-1]=N,L.events=U,L.iterations=ee,L}}e+=f,a=N,k=I,f=xe(.8*f*be(i/V,.25),4*f)}return L.iterations=ee,L}const we=2;function me(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}function ue(e,t){return e[0]*t[1]-e[1]*t[0]}function v(e,t){return[e[2*t],e[2*t+1]]}function P(e,t,a){e[0]|=3<<2*a,e[2*a+1]=t[0],e[2*a+2]=t[1]}function He(e,t,a){this.p1=e,this.p2=t,this.oneway=a,this.name="Rod"}function Je(e,t,a){this.p1=e,this.p2=JSON.parse(JSON.stringify(t)),this.p3=a,this.name="Rope"}function Ue(e,t,a){this.reference=e,this.slide=t,this.base=a,this.fatmode=!1,this.name="F2k"}function We(e,t,a,n){this.reference=e,this.slide=t,this.base=a,this.oneway=n,this.name="Colinear"}function de(e,t,a){this.p=e,this.n=me(t),this.oneway=a,this.name="Slider"}function Ge(e,t,a,n){this.forces=Array(t.length).fill([0,-1]).flat(),this.constraints=e,this.masses=t.flatMap(i=>[i,i]),this.positions=a,this.velocities=n}function Ve(e){let t={rod:[],slider:[],colinear:[],f2k:[],rope:[],pin:[]};for(let a of e)if(a.oneway!=we)switch(a.name){case"Rod":t.rod.push({p1:a.p1,p2:a.p2,oneway:a.oneway});break;case"Slider":t.slider.push({p:a.p,normal:{x:a.n[0],y:a.n[1]},oneway:a.oneway});break;case"Colinear":t.colinear.push({reference:a.reference,slider:a.slide,base:a.base,oneway:a.oneway});break;case"F2k":t.f2k.push({reference:a.reference,slider:a.slide,base:a.base});break;case"Rope":t.rope.push({p1:a.p1,pulleys:a.p2.filter(n=>n.wrapping!="cw_drop"&&n.wrapping!="ccw_drop"),p3:a.p3});break}return t}function Me(e,t,a,n,i){let r=[],o=[],s=[];for(var c of e)r.push(c.mass),o.push(c.x),o.push(c.y);for(var l of t.rod)s.push(new He(l.p1,l.p2,l.oneway));for(var p of t.slider)s.push(new de(p.p,[p.normal.x,p.normal.y],p.oneway));for(var p of t.pin)s.push(new de(p.p,[0,1],!1)),s.push(new de(p.p,[1,0],!1));for(var d of t.colinear)s.push(new We(d.reference,d.slider,d.base,d.oneway));for(var u of t.f2k)s.push(new Ue(u.reference,u.slider,u.base));for(var h of t.rope)s.push(new Je(h.p1,h.pulleys.slice(),h.p3));var x=new Ge(s,r,o,new Array(o.length).fill(0));x.terminate=i;let m=x.positions.concat(x.velocities);return Ke(x,m,a,n)}function Ke(e,t,a,n){for(var i=[],r=[],o=[],s=(d,u)=>{for(D.clear();d<i[i.length-1];){i.pop(),o.pop();var h=r.pop();e.constraints=JSON.parse(h),e.stringConstraint=h}return i.push(d),0|!e.stringConstraint&&(e.stringConstraint=JSON.stringify(e.constraints)),r.push(e.stringConstraint),o.push(e.constraintForces),Ze(e,u)[0]},c=De(0,n,t,s,1e-6,1e4),l=[],p=0;p<n;)l.push(c.at(p)),p+=a;return[l,[i,r],o]}function Qe(e){for(var t=D.getMat(e.constraints.length,e.masses.length+1),a=0;a<e.constraints.length;a++){var n=e.constraints[a],i=t[a];i[0]=0,n.oneway!==we&&(n.name==="Rod"&&et(i,n,e),n.name==="Slider"&&tt(i,n),n.name==="Colinear"&&rt(i,n,e),n.name==="F2k"&&lt(i,n,e),n.name==="Rope"&&at(i,n,e))}var r=Be(t,e.masses);r=Re(r,t);for(var o=0;o<r.length;o++)r[o][o]==0&&(r[o][o]=1);for(var s=D.getVec(e.constraints.length),a=0;a<e.constraints.length;a++){var n=e.constraints[a];n.name==="Rod"&&(s[a]=nt(n,e)),n.name==="Slider"&&(s[a]=it(n,e)),n.name==="Colinear"&&(s[a]=st(n,e)),n.name==="F2k"&&(s[a]=ct(n,e)),n.name==="Rope"&&(s[a]=ot(n,e))}let c=qe(r,s);e.constraintForces=c;for(var o=0;o<c.length;o++)e.constraints[o].force=c[o];let l=Ne(Oe(Ye([c],t),e.masses)[0],e.forces);for(var o=0;o<c.length;o++)if(c[o]>0&&e.constraints[o].oneway===!0){e.constraints[o].oneway=we,e.stringConstraint=null;break}return[l,!1]}function Ze(e,t){e.positions=t.slice(0,e.positions.length),e.velocities=t.slice(e.positions.length,t.length);let[a,n]=Qe(e);if(e.terminate(t)){for(var i=window.data.projectile,r=0;r<e.constraints.length;r++)if(e.constraints[r].p1===i||e.constraints[r].p2===i||e.constraints[r].p3===i){e.constraints.splice(r,1),e.stringConstraint=null;break}}return[e.velocities.concat(a),!1]}function et(e,t,a){let n=me(A(v(a.positions,t.p1),v(a.positions,t.p2)));return P(e,n,t.p2),P(e,[-n[0],-n[1]],t.p1),e}function tt(e,t,a){return P(e,t.n,t.p),e}function nt(e,t){let a=A(v(t.positions,e.p1),v(t.positions,e.p2)),n=A(v(t.velocities,e.p1),v(t.velocities,e.p2)),i=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return(n[0]*n[0]+n[1]*n[1])/i}function at(e,t,a){var n=[];n.push(t.p1);for(var i of t.p2)n.push(i.idx);n.push(t.p3);for(var r=1;r<n.length-1;r++)if(t.p2[r-1].wrapping=="ccw_drop"||t.p2[r-1].wrapping=="cw_drop"){for(var o=r-1;o>0&&(t.p2[o-1].wrapping=="ccw_drop"||t.p2[o-1].wrapping=="cw_drop");)o-=1;for(var s=r+1;s<n.length-2&&(t.p2[s-1].wrapping=="ccw_drop"||t.p2[s-1].wrapping=="cw_drop");)s+=1;var c=v(a.positions,n[o]),l=v(a.positions,n[r]),p=v(a.positions,n[s]),d=ue(A(c,l),A(l,p));if(d>0&&t.p2[r-1].wrapping=="ccw_drop"||d<0&&t.p2[r-1].wrapping=="cw_drop"){t.p2[r-1].wrapping="both",a.stringConstraint=null;break}}n=[],n.push(t.p1);var u=0,h=[-1];for(var i of t.p2)i.wrapping!="ccw_drop"&&i.wrapping!="cw_drop"&&(n.push(i.idx),h.push(u)),u+=1;n.push(t.p3);for(var r=1;r<n.length-1;r++){var c=v(a.positions,n[r-1]),l=v(a.positions,n[r]),p=v(a.positions,n[r+1]),d=ue(A(c,l),A(l,p));if(d>0&&t.p2[h[r]].wrapping=="ccw"||d<0&&t.p2[h[r]].wrapping=="cw"){t.p2.splice(h[r],1),a.stringConstraint=null;break}}n=[],n.push(t.p1);for(var i of t.p2)i.wrapping!="ccw_drop"&&i.wrapping!="cw_drop"&&n.push(i.idx);n.push(t.p3),e.fill(0);for(var r=0;r<n.length-1;r++){let m=n[r],$=n[r+1],S=me(A(v(a.positions,m),v(a.positions,$))),z=v(e,m+.5);P(e,A(z,S),m),P(e,S,$)}return e}function ot(e,t){var a=0,n=[];n.push(e.p1);for(var i of e.p2)i.wrapping!="ccw_drop"&&i.wrapping!="cw_drop"&&n.push(i.idx);n.push(e.p3);for(var r=0;r<n.length-1;r++){let o=n[r],s=n[r+1],c=A(v(t.positions,o),v(t.positions,s)),l=A(v(t.velocities,o),v(t.velocities,s)),p=Math.sqrt(c[0]*c[0]+c[1]*c[1]);a+=Math.pow(ue(c,l),2)/(p*p*p)}return a}function it(e,t){var a=v(t.forces,e.p);return e.n[0]*a[0]+e.n[1]*a[1]}function rt(e,t,a){var[n,i]=v(a.positions,t.slide);v(a.velocities,t.slide);var[r,o]=v(a.positions,t.reference);v(a.velocities,t.reference);var[s,c]=v(a.positions,t.base);v(a.velocities,t.base),n=n-s,i=i-c,r=r-s,o=o-c;var l=Math.sqrt(r*r+o*o),p=l*l*l,d=-o/l,u=r/l,h=(n*r*o+i*o*o)/p,x=-(n*r*r+r*i*o)/p,m=-d-h,$=-u-x;return P(e,[d,u],t.slide),P(e,[h,x],t.reference),P(e,[m,$],t.base),e}function st(e,t){var[a,n]=v(t.positions,e.slide),[i,r]=v(t.velocities,e.slide),[o,s]=v(t.positions,e.reference),[c,l]=v(t.velocities,e.reference),[p,d]=v(t.positions,e.base),[u,h]=v(t.velocities,e.base);a=a-p,n=n-d,i=i-u,r=r-h,o=o-p,s=s-d,c=c-u,l=l-h;var x=Math.sqrt(o*o+s*s),m=o/x,$=s/x,S=(l*m-c*$)*(((2*c*a-l*n)*m*m+(l*a+c*n)*3*m*$+(2*l*n-c*a)*$*$)/(x*x)-2*(i*m+r*$)/x);return-S}function lt(e,t,a){var[n,i]=v(a.positions,t.slide);v(a.velocities,t.slide);var[r,o]=v(a.positions,t.reference);v(a.velocities,t.reference);var[s,c]=v(a.positions,t.base);if(v(a.velocities,t.base),n=n-s,i=i-c,r=r-s,o=o-c,o<0){if(!t.fatmode){var l=n,p=r-n;t.ratio=l/p}t.fatmode=!0,a.stringConstraint=null}if(t.fatmode)return P(e,[0,1],t.base),P(e,[0,t.ratio],t.reference),e;var d=Math.sqrt(r*r+o*o),u=d*d*d,h=-o/d,x=r/d,m=(n*r*o+i*o*o)/u,$=-(n*r*r+r*i*o)/u,S=-h-m,z=-x-$;return P(e,[h,x],t.slide),P(e,[m,$],t.reference),P(e,[S,z],t.base),e}function ct(e,t){if(e.fatmode)return-1-e.ratio;var[a,n]=v(t.positions,e.slide),[i,r]=v(t.velocities,e.slide),[o,s]=v(t.positions,e.reference),[c,l]=v(t.velocities,e.reference),[p,d]=v(t.positions,e.base),[u,h]=v(t.velocities,e.base);a=a-p,n=n-d,i=i-u,r=r-h,o=o-p,s=s-d,c=c-u,l=l-h;var x=Math.sqrt(o*o+s*s),m=(2*c*a*o*o-2*i*o*o*o-l*o*o*n+3*l*a*o*s-2*r*o*o*s+3*c*o*n*s-c*a*s*s-2*i*o*s*s+2*l*n*s*s-2*r*s*s*s)*(l*o-c*s)/(x*x*x*x*x);return-m}const pt=["rod","pin","slider","colinear","f2k","rope"];function ve(e){for(const a of pt)e.constraints[a]===void 0&&(e.constraints[a]=[]);const t=e.particles.map(()=>0);e.constraints.slider.forEach(a=>{a.oneway||(t[a.p]+=1)}),e.constraints.slider=e.constraints.slider.filter(a=>t[a.p]<2),e.constraints.pin=e.constraints.pin.concat(t.flatMap((a,n)=>[{count:a,p:n}]).filter(a=>a.count>1))}function dt(e){return Math.max(...e.slice(1).map(t=>Math.max(...t.map(a=>Math.abs(a)))))}function wt(e,t){let a=-t.particles[t.mainaxle].y,n=-t.particles[t.mainaxle].y,i=0;for(const s of e){for(let c=0;c<t.particles.length;c++)s[2*c]<2e3&&(n=Math.min(n,-s[2*c+1])),a=Math.max(a,-s[2*t.mainaxle+1]);i=Math.max(i,2*Math.max(0,-s[2*t.particles.length+2*t.projectile+1])*s[2*t.particles.length+2*t.projectile])}const r=a-n,o=Math.sqrt(Math.pow(t.particles[t.armtip].x-t.particles[t.mainaxle].x,2)+Math.pow(t.particles[t.armtip].y-t.particles[t.projectile].y,2));return i=i/Math.max(r,.75*o)*t.axleheight,i}const Ce={"Hinged Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":588,"y":440.7,"mass":10},{"x":668,"y":673.6,"mass":1},{"x":586,"y":533.7,"mass":100}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Fixed Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":668,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Floating Arm Trebuchet":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":487.0,"y":517.0,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":589,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',F2k:'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.6,"duration":35,"particles":[{"x":454,"y":516,"mass":1},{"x":436.6,"y":513.0,"mass":4},{"x":560.3,"y":211.5,"mass":100},{"x":652.9,"y":621.8,"mass":1}],"constraints":{"rod":[{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":1,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":0,"normal":{"x":0,"y":1}}],"colinear":[],"f2k":[{"reference":1,"slider":0,"base":2}],"rope":[]}}',"Floating Arm Whipper (NASAW)":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":37,"particles":[{"x":496.3,"y":477.6,"mass":1},{"x":677.5,"y":471.0,"mass":4},{"x":468.0,"y":453.5,"mass":10},{"x":557.0,"y":431.8,"mass":1},{"x":563.0,"y":340.7,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":4,"normal":{"x":0.6,"y":0}}],"colinear":[]}}',Whipper:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3,"duration":60,"particles":[{"x":536,"y":472.7,"mass":1},{"x":759,"y":451,"mass":4},{"x":483,"y":498,"mass":10},{"x":551,"y":434,"mass":1},{"x":560,"y":368,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":0}}]}}',Fiffer:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":20,"particles":[{"x":536,"y":472.7,"mass":1},{"x":484,"y":656,"mass":4},{"x":504,"y":433,"mass":10},{"x":644,"y":661,"mass":1},{"x":653,"y":451,"mass":10},{"x":749,"y":428,"mass":1},{"x":749,"y":483,"mass":500},{"x":566,"y":505,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":7,"p2":6},{"p1":6,"p2":4},{"p1":4,"p2":5}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":7,"normal":{"x":0.7,"y":1}},{"p":7,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0.7,"y":1}}]}}',"Floating Arm King Arthur":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":40,"particles":[{"x":536,"y":472.7,"mass":1},{"x":527,"y":610,"mass":4},{"x":534,"y":418,"mass":10},{"x":698,"y":608,"mass":1},{"x":560,"y":331,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":-0.5,"y":0},"oneway":true},{"p":1,"normal":{"x":0.7,"y":0},"oneway":true},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Launch Ness Monster":'{"projectile":3,"mainaxle":2,"armtip":1,"axleheight":8,"timestep":0.3,"duration":80,"particles":[{"x":600.7,"y":746.2,"mass":10},{"x":559.1,"y":774.0,"mass":4},{"x":660.2,"y":530.0,"mass":100},{"x":703.9,"y":796.7,"mass":1},{"x":810,"y":530,"mass":10},{"x":552,"y":500,"mass":10},{"x":458,"y":666,"mass":10},{"x":886.1,"y":662.4,"mass":10}],"constraints":{"rod":[{"p1":2,"p2":1},{"p1":3,"p2":1},{"p1":6,"p2":5},{"p1":5,"p2":2},{"p1":4,"p2":2},{"p1":4,"p2":7},{"p1":5,"p2":4}],"slider":[{"p":0,"normal":{"x":1,"y":2.1}},{"p":0,"normal":{"x":-0.6,"y":1.6}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":6,"normal":{"x":0.6,"y":1}},{"p":6,"normal":{"x":0,"y":1}},{"p":7,"normal":{"x":1,"y":1}},{"p":7,"normal":{"x":0,"y":1}}],"colinear":[{"reference":1,"slider":0,"base":2}]}}',"Pulley Sling":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":35,"particles":[{"x":546.3,"y":584.3,"mass":1},{"x":285.6,"y":791.6,"mass":4},{"x":560.6,"y":481.2,"mass":10},{"x":1000.9,"y":742.8,"mass":1},{"x":645.5,"y":541.0,"mass":500},{"x":72.7,"y":730.2,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":5,"normal":{"x":1,"y":1}},{"p":5,"normal":{"x":0,"y":1}}],"colinear":[],"rope":[{"p1":5,"pulleys":[{"idx":1,"wrapping":"both"}],"p3":3}]}}',MURLIN:'{"projectile":8,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.1,"duration":40,"particles":[{"x":510.98330181224014,"y":585.0346326615387,"mass":1,"hovered":false},{"x":610.8818474508025,"y":509.1784380643879,"mass":1,"hovered":false},{"x":530.7749198606792,"y":582.2639014087384,"mass":1,"hovered":false},{"x":508.2352941176471,"y":627.2941140567556,"mass":1,"hovered":false},{"x":437.64705882352945,"y":593.176466997932,"mass":1,"hovered":false},{"x":477.64705882352945,"y":495.5294081744026,"mass":1,"hovered":false},{"x":648.2352941176471,"y":446.1176434685202,"mass":1,"hovered":false},{"x":648.2352941176471,"y":464.94117288028497,"mass":200,"hovered":false},{"x":462.2625079139531,"y":570.2700562274708,"mass":1,"hovered":false}],"constraints":{"rod":[{"p1":2,"p2":1,"hovered":false},{"p1":2,"p2":0,"hovered":false},{"p1":1,"p2":0,"hovered":false},{"p1":3,"p2":2,"hovered":false},{"p1":3,"p2":0,"hovered":false},{"p1":4,"p2":3,"hovered":false},{"p1":4,"p2":0,"hovered":false},{"p1":5,"p2":4,"hovered":false},{"p1":5,"p2":0,"hovered":false},{"p1":8,"p2":1,"hovered":false},{"p1":8,"p2":0,"hovered":false,"oneway":true}],"slider":[],"colinear":[],"f2k":[],"rope":[{"p1":7,"pulleys":[{"idx":6,"wrapping":"ccw"},{"idx":5,"wrapping":"ccw"},{"idx":4,"wrapping":"ccw"},{"idx":3,"wrapping":"ccw"}],"p3":2,"hovered":false}],"pin":[{"count":2,"p":0},{"count":2,"p":6}]}}'};function _e(e){return e[0].map((t,a)=>e.map(n=>n[a]))}function ut(e){return e=_e(e),e.map(t=>t.reduce((a,n)=>a+n,0)/t.length)}function ft(e,t){e=_e(e);const a=e[0].length;return e.map((n,i)=>e.map((r,o)=>n.reduce((s,c,l)=>s+(e[i][l]-t[i])*(e[o][l]-t[o]),0)/(a-1)))}function ht(e){const t=e.length,a=Array(t).fill().map(()=>Array(t).fill(0));for(let n=0;n<t;n++)for(let i=0;i<=n;i++){let r=0;for(let o=0;o<i;o++)r+=a[n][o]*a[i][o];a[n][i]=n===i?Math.sqrt(e[n][n]-r):(e[n][i]-r)/a[i][i]}return a}function ke(){let e=0,t=0;for(;e===0;)e=Math.random();for(;t===0;)t=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}function mt(e,t){const a=e.map(()=>ke());return e.map((n,i)=>n+t[i].reduce((r,o,s)=>r+o*a[s],0))}async function Ee(e){const{initialConfig:t,objectiveFunction:a,shouldStop:n,onImprovement:i=null,initialStepSize:r=.6,populationMultiplier:o=25,improvementCheckInterval:s=1}=e;let c=[...t],l=[],p=0;const d=o*c.length;for(;!n();){let u;if(p>d){l=l.slice(0,d);const m=l.map(B=>B[1]),$=ut(m),S=ft(m,$),z=ht(S);u=mt(c,z)}else u=c.map(m=>m+ke()*r);const h=a(u);p+=1,l.push([h,u]),(p%s===1||l.length>0&&h>l[0][0])&&i&&await i(u,h),l=l.sort((m,$)=>$[0]-m[0]),c=l[0][1]}return c}var vt=["rod","pin","slider","colinear","f2k","rope"];const b=document.getElementById("mechanism");b.addEventListener("touchstart",function(e){var t=e.touches[0],a=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});b.dispatchEvent(a)});b.addEventListener("touchend",function(e){var t=new MouseEvent("mouseup",{});b.dispatchEvent(t)});b.addEventListener("touchmove",function(e){if(!(e.touches.length>1)&&R!==null){e.preventDefault();var t=e.touches[0],a=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});b.dispatchEvent(a)}});const w=b.getContext("2d");window.data={duration:50,timestep:1,projectile:3,mainaxle:0,armtip:1,axleheight:8,particles:[{x:100,y:100,mass:1,hovered:!1}],constraints:{rod:[],slider:[]}};async function gt(){for(var e=0;e<600;e+=5)for(var t=300;t<900;t+=5){window.data.particles[2].x=e,window.data.particles[2].y=t;var[a,n,i,r]=Q();w.beginPath(),w.arc(e,t,4,0,Math.PI*2);var o=256*n/4e4;w.fillStyle=`rgb(${o}, ${256*Math.sin(o/10)}, ${o})`,w.fill(),t%50==0&&await window.waitForAnimationFrame()}}async function Pe(){return new Promise(e=>{setTimeout(()=>{e()},1)})}async function Se(){await new Promise(e=>{requestAnimationFrame(()=>{e()})})}async function yt(){if(window.data.timestep!=1){var e=JSON.stringify(window.data),[t,a,n]=Me(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,ge),i=window.data.timestep;window.data.timestep=0;var r=0,o=0;for(var s of t){for(;a[0][o+1]<r;)o+=1;r+=i;var c=JSON.parse(a[1][o]);window.data.constraints=Ve(c);for(var l=0;l<window.data.particles.length;l++)window.data.particles[l].x=s[2*l],window.data.particles[l].y=s[2*l+1];_(),await Se()}window.data=JSON.parse(e),_()}}function ge(e){e[2*window.data.armtip]-e[2*window.data.projectile],e[2*window.data.armtip+1]-e[2*window.data.projectile+1],e[2*window.data.armtip]-e[2*window.data.mainaxle],e[2*window.data.armtip+1]-e[2*window.data.mainaxle+1];var t=e[2*window.data.projectile+2*window.data.particles.length],a=e[2*window.data.projectile+2*window.data.particles.length+1];return t>100&&a>0}function Q(){var e=Date.now();const[t,a,n]=Me(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,ge);window.constraintLog=a,window.forceLog=n;var i=dt(n),r=wt(t,window.data),o=Date.now();return document.getElementById("simtime").innerText=o-e,[t,r,a,i]}function _(){if(Ae(),w.save(),w.setTransform(1,0,0,1,0,0),w.clearRect(0,0,b.width,b.height),w.restore(),w.setTransform(1,0,0,1,0,0),window.data.particles.length>1&&window.data.constraints.rod.length+window.data.constraints.slider.length>1&&window.data.timestep>0&&typeof window.data.timestep=="number"){var[e,t,a,n]=Q();document.getElementById("range").innerText=t.toFixed(1),document.getElementById("peakLoad").innerText=n.toFixed(1);var i=0,r=0;e.forEach(o=>{for(;a[0][r+1]<i;)r+=1;i+=window.data.timestep;for(let l=0;l<window.data.constraints.rod.length;l++)if(window.data.constraints.rod[l].oneway!=!0){const p=window.data.constraints.rod[l],d=p.p1*2,u=p.p2*2;w.beginPath(),w.moveTo(o[d],o[d+1]),w.lineTo(o[u],o[u+1]),w.strokeStyle="rgba(255, 0, 0, 0.2)",w.stroke()}for(let l=0;l<window.data.constraints.rope.length;l++)if(window.data.constraints.rope[l].oneway!=!0){const p=window.data.constraints.rope[l],d=p.p1*2,u=p.p3*2;w.beginPath(),w.moveTo(o[d],o[d+1]);for(var s of window.data.constraints.rope[l].pulleys){var c=s.idx*2;w.lineTo(o[c],o[c+1])}w.lineTo(o[u],o[u+1]),w.strokeStyle="rgba(255, 0, 0, 0.2)",w.stroke()}}),w.strokeStyle="black"}w.lineWidth=3,window.data.constraints.rod.forEach(o=>{const s=window.data.particles[o.p1],c=window.data.particles[o.p2];w.beginPath(),w.moveTo(s.x,s.y),w.lineTo(c.x,c.y),w.strokeStyle=o.hovered?"yellow":"black",w.stroke()}),window.data.constraints.rope.forEach(o=>{const s=window.data.particles[o.p1],c=window.data.particles[o.p3];w.setLineDash([8,8]),w.beginPath(),w.moveTo(s.x,s.y);for(var l of o.pulleys){const p=window.data.particles[l.idx];w.lineTo(p.x,p.y)}w.lineTo(c.x,c.y),w.strokeStyle=o.hovered?"yellow":"black",w.stroke(),w.setLineDash([])}),window.data.constraints.slider.concat(window.data.constraints.pin.flatMap(o=>[{p:o.p,normal:{x:0,y:1}},{p:o.p,normal:{x:1,y:0}}])).forEach(o=>{const s=window.data.particles[o.p],c=40,l=Math.atan2(o.normal.y,o.normal.x)+Math.PI/2;w.beginPath(),w.moveTo(s.x-c*Math.cos(l),s.y-c*Math.sin(l)),w.lineTo(s.x+c*Math.cos(l),s.y+c*Math.sin(l)),w.strokeStyle=o.hovered?"yellow":"black",w.stroke()}),window.data.constraints.colinear.concat(window.data.constraints.f2k).forEach(o=>{const s=window.data.particles[o.base],c=window.data.particles[o.reference],l=window.data.particles[o.slider],p=Math.sqrt((s.x-c.x)*(s.x-c.x)+(s.y-c.y)*(s.y-c.y)),d=(s.x-c.x)/p,u=(s.y-c.y)/p,h=Math.abs(d*(s.y-l.y)-u*(s.x-l.x));w.beginPath(),w.arc(l.x,l.y,h,0,Math.PI*2),w.strokeStyle="grey",w.stroke()}),w.lineWidth=1,window.data.particles.forEach((o,s)=>{const c=Math.cbrt(o.mass)*4;w.beginPath(),w.arc(o.x,o.y,c,0,Math.PI*2),w.fillStyle=o.hovered?"yellow":"black",w.strokeStyle="black",s==window.data.projectile&&(w.fillStyle="lightblue",w.strokeStyle="blue"),w.fill(),w.stroke(),w.font="18px Arial",w.textAlign="center",w.textBaseline="middle",w.fillStyle="black",w.fillText(`P${s+1}`,o.x,o.y-c-10)})}function xt(){const e={x:100,y:100,mass:1,hovered:!1};window.data.particles.push(e),C()}function bt(e,t,a){window.data.particles[e][t]=Number(a),_()}function $t(e){window.data.particles.splice(e,1);for(var t in window.data.constraints)for(var a=window.data.constraints[t],n=!1;!n;){n=!0;for(var i=0;i<a.length;i++){var r=a[i],o=!1;for(var s of["p","p1","p2","p3","reference","base","slider"])r[s]===e&&(o=!0);o&&(n=!1,a.splice(i,1))}}for(var s of["projectile","armtip","mainaxle"])window.data[s]===e&&(window.data[s]=0);C()}function Mt(e){let t={};if(e==="rod"){if(window.data.particles.length<2){alert("At least two particles are required to create a rod constraint.");return}var a=[];for(let r=window.data.particles.length-1;r>=0;r--)for(let o=window.data.particles.length-1;o>=0;o--)le(r,o)||a.push([r,o]);t={p1:a[0][0],p2:a[0][1],hovered:!1},window.data.constraints.rod.push(t)}else if(e==="slider"){if(window.data.particles.length<1){alert("At least one particle is required to create a slider constraint.");return}var n=window.data.constraints.slider,i=window.data.particles.length-1;n.length>0&&n[n.length-1].p==i&&n[n.length-1].normal.x==0&&n[n.length-1].normal.y==1?t={p:i,normal:{x:1,y:0},hovered:!1}:t={p:i,normal:{x:0,y:1},hovered:!1},window.data.constraints.slider.push(t)}else if(e==="colinear")t={reference:0,slider:1,base:2},window.data.constraints.colinear.push(t);else if(e==="pin")t={p:window.data.particles.length-1},window.data.constraints.pin.push(t);else if(e==="f2k")t={reference:0,slider:1,base:2},window.data.constraints.f2k.push(t);else if(e==="rope")t={p1:0,pulleys:[],p3:2},window.data.constraints.rope.push(t);else{console.error("Unknown constraint type:",e);return}C()}function Ct(e,t,a){const n=+e.value,i=window.data.constraints.rope[t];i.pulleys[a].idx=n,C()}function _t(e,t,a){const n=e.value,i=window.data.constraints.rope[t];i.pulleys[a].wrapping=n,C()}function kt(e){window.data.constraints.rope[e].pulleys.pop(),C()}function Et(e){window.data.constraints.rope[e].pulleys.push({idx:0,wrapping:"both"}),C()}function Pt(e,t,a,n){const i=n.includes("normal")?parseFloat(e.value):parseInt(e.value),r=window.data.constraints[t][a];n==="p1"||n==="p2"||n==="p"?(r[n]=i,C()):n==="normalX"||n==="normalY"?(r.normal[n.slice(-1).toLowerCase()]=i,_()):(r[n]=i,C())}function St(e,t){window.data.constraints[e].splice(t,1),C()}function ye(){var e=Math.min(window.screen.width,window.innerWidth);console.log(e),e>1040&&(e-=440),e=Math.min(e,window.innerHeight-130),e=Math.max(e,400),b.width=600*1.9,b.height=600*1.9,b.style.width=e+"px",b.style.height=e+"px",window.innerWidth-e>840?document.getElementById("allcontrols").style.flexDirection="row":document.getElementById("allcontrols").style.flexDirection="column",C()}function C(){_(),document.getElementById("timestep").value=window.data.timestep,document.getElementById("duration").value=window.data.duration;const e=document.getElementById("particlesControl");for(;e.children.length>1;)e.removeChild(e.lastChild);window.data.particles.forEach((l,p)=>Le(p));const t=document.getElementById("constraintsControl");for(;t.children.length>1;)t.removeChild(t.lastChild);for(var a of vt)window.data.constraints[a].forEach((l,p)=>ze(a,p));const n=document.getElementById("presets");for(;n.children.length>0;)n.removeChild(n.lastChild);const i=document.createElement("option");i.selected="true",i.innerHTML="Presets",n.appendChild(i);for(var r of Object.keys(Ce)){const l=document.createElement("option");l.innerHTML=r,l.value=r,n.appendChild(l)}for(var o of["armtip","projectile","mainaxle"]){for(var s=document.getElementById(o);s.children.length>0;)s.removeChild(s.lastChild);for(var c=0;c<window.data.particles.length;c++){const l=document.createElement("option");l.selected=window.data[o]==c,l.innerHTML=`P ${c+1}`,l.value=c,s.appendChild(l)}}document.getElementById("axleheight").value=window.data.axleheight}function fe(e){window.data=JSON.parse(Ce[e.value]),ve(window.data),Ie()}window.normalizeSize=Ie;function Ie(){var[e,t,t,t]=Q(),a=999,n=999,i=0,r=0;e.forEach(c=>{for(var l=0;l<c.length/2;l+=2){var p=c[l],d=c[l+1];a=Math.min(p,a),l/2!=window.data.projectile&&(i=Math.max(i,p)),p<1200&&(n=Math.min(d,n)),r=Math.max(d,r)}});var o=Math.max(i-a,r-n);window.data.duration=Math.round(window.data.duration*Math.sqrt(1/o*.8*600*1.9));for(var s of window.data.particles)s.x-=a,s.x/=o,s.x*=.8,s.x+=.1,s.x*=600*1.9,s.y-=n,s.y/=o,s.y*=.8,s.y+=.1,s.y*=600*1.9;C()}function Le(e){const t=document.createElement("div");t.className="control-box",t.innerHTML=`
                P ${1+e} <label>Mass <input type="text" min="1" max="500" value="${window.data.particles[e].mass}" oninput="updateParticle(${e}, 'mass', this.value)"></label>
                <label>X <input type="text" min="0" max="${b.width}" value="${window.data.particles[e].x}" oninput="updateParticle(${e}, 'x', this.value)"></label>
                <label>Y <input type="text" min="0" max="${b.height}" value="${window.data.particles[e].y}" oninput="updateParticle(${e}, 'y', this.value)"></label>
                ${e==data.particles.length-1?`<button class=delete onclick="deleteParticle(${e})">X</button>`:""}
              `,t.addEventListener("mouseenter",()=>{window.data.particles[e].hovered=!0,_()}),t.addEventListener("mouseleave",()=>{window.data.particles[e].hovered=!1,_()}),document.getElementById("particlesControl").appendChild(t)}function le(e,t){if(e==t)return!0;for(var a of window.data.constraints.rod)if(a.p1==e&&a.p2==t||a.p1==t&&a.p2==e||e==t)return!0;return!1}function ze(e,t){const a=document.createElement("div");if(a.className="control-box",a.dataset.type=e,a.dataset.index=t,e==="rod")a.innerHTML=`Rod
                    <select name="p1" onchange="updateConstraint(this, 'rod', ${t}, 'p1')">
            	   ${window.data.particles.map((n,i)=>i).filter(n=>!le(window.data.constraints.rod[t].p2,n)||n==window.data.constraints.rod[t].p1).map(n=>`<option value="${n}" ${n===window.data.constraints.rod[t].p1?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
                    <select name="p2" onchange="updateConstraint(this, 'rod', ${t}, 'p2')">
            	   ${window.data.particles.map((n,i)=>i).filter(n=>!le(window.data.constraints.rod[t].p1,n)||n==window.data.constraints.rod[t].p2).map(n=>`<option value="${n}" ${n===window.data.constraints.rod[t].p2?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    One way
            			<input type="checkbox" oninput="window.data.constraints.rod[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.rod[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('rod', ${t})">X</button>
                `;else if(e==="slider"){const n=window.data.constraints.slider[t];a.innerHTML=`
                  <label>
            		Slider
                    <select name="p" onchange="updateConstraint(this, 'slider', ${t}, 'p')">
                      ${window.data.particles.map((i,r)=>`<option value="${r}" ${r===n.p?"selected":""}>P ${r+1}</option>`).join("")}
                    </select>
                  </label>
                  <label>Normal X <input type="range" name="normalX" min="-1" max="1" step="0.1" value="${n.normal.x}" oninput="updateConstraint(this, 'slider', ${t}, 'normalX')"></label>
                  <label>Normal Y <input type="range" name="normalY" min="-1" max="1" step="0.1" value="${n.normal.y}" oninput="updateConstraint(this, 'slider', ${t}, 'normalY')"></label>
		  One way
            			<input type="checkbox" oninput="window.data.constraints.slider[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.slider[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('slider', ${t})">X</button>
                `}else e==="colinear"?a.innerHTML=`Roller Track1
                    <select name="reference" onchange="updateConstraint(this, 'colinear', ${t}, 'reference')">
            	   ${window.data.particles.map((n,i)=>i).map(n=>`<option value="${n}" ${n===window.data.constraints.colinear[t].reference?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    Slide
                    <select name="slider" onchange="updateConstraint(this, 'colinear', ${t}, 'slider')">

            	   ${window.data.particles.map((n,i)=>i).map(n=>`<option value="${n}" ${n===window.data.constraints.colinear[t].slider?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    Track2
                    <select name="base" onchange="updateConstraint(this, 'colinear', ${t}, 'base')">

            	   ${window.data.particles.map((n,i)=>i).map(n=>`<option value="${n}" ${n===window.data.constraints.colinear[t].base?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
            			<input type="checkbox" oninput="window.data.constraints.colinear[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.colinear[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('colinear', ${t})">X</button>
                `:e==="pin"?a.innerHTML=`Pin <select onchange="updateConstraint(this, 'pin', ${t}, 'p')">${window.data.particles.map((n,i)=>`<option value="${i}" ${i===window.data.constraints.pin[t].p?"selected":""}>P ${i+1}</option>`).join("")}</select>

                  <button class=delete onclick="deleteConstraint('pin', ${t})">X</button>
		  `:e==="f2k"?a.innerHTML=`F2k <label>Arm Tip
                    <select name="reference" onchange="updateConstraint(this, 'f2k', ${t}, 'reference')">
            	   ${window.data.particles.map((n,i)=>i).map(n=>`<option value="${n}" ${n===window.data.constraints.f2k[t].reference?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    </label> <label>
		    Roller 
                    <select name="slider" onchange="updateConstraint(this, 'f2k', ${t}, 'slider')">

            	   ${window.data.particles.map((n,i)=>i).map(n=>`<option value="${n}" ${n===window.data.constraints.f2k[t].slider?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    </label> <label>
		    Arm Base
                    <select name="base" onchange="updateConstraint(this, 'f2k', ${t}, 'base')">

            	   ${window.data.particles.map((n,i)=>i).map(n=>`<option value="${n}" ${n===window.data.constraints.f2k[t].base?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    </label> <label>
		    One way
            			<input type="checkbox" oninput="window.data.constraints.f2k[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.f2k[t].oneway?"checked":""}></input></label>
                  <button class=delete onclick="deleteConstraint('f2k', ${t})">X</button>
                `:e==="rope"&&(a.innerHTML=`
				Rope and pulley.
				<label>
				Fixed end:
				<select name="p1" onchange="updateConstraint(this, 'rope', ${t}, 'p1')">
								${window.data.particles.map((n,i)=>i).map(n=>`<option value="${n}" ${n===window.data.constraints.rope[t].p1?"selected":""}>P ${n+1}</option>`).join("")}
				</select></label>
${window.data.constraints.rope[t].pulleys.map((n,i)=>`
<label>Pulley
<select name="p2" onchange="updatePulley(this, ${t}, ${i})">

${window.data.particles.map((r,o)=>o).map(r=>`<option value="${r}" ${r===n.idx?"selected":""}>P ${r+1}</option>`).join("")}
</select>
<select onchange="updatePulleyDirection(this, ${t}, ${i})">
${["both","cw","ccw","cw_drop","ccw_drop"].map(r=>`<option value=${r} ${r==n.wrapping?"selected":""}>${r}</option>`).join("")}
</select></label>
`).join("")}
<button onclick="addPulley(${t})">+</button>
<button onclick="removePulley(${t})">-</button>
<label>Fixed end
<select name="p3" onchange="updateConstraint(this, 'rope', ${t}, 'p3')">

${window.data.particles.map((n,i)=>i).map(n=>`<option value="${n}" ${n===window.data.constraints.rope[t].p3?"selected":""}>P ${n+1}</option>`).join("")}
</select>
</label>
<button class=delete onclick="deleteConstraint('rope', ${t})">X</button>
<input type="checkbox" oninput="window.data.constraints.rope[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.rope[t].oneway?"checked":""}></input>
`);a.addEventListener("mouseenter",()=>{window.data.constraints[e][t].hovered=!0,_()}),a.addEventListener("mouseleave",()=>{window.data.constraints[e][t].hovered=!1,_()}),document.getElementById("constraintsControl").appendChild(a)}let R=null;function Te(e,t){var a=window.data.particles.findIndex(n=>{const i=Math.sqrt((n.x-e)**2+(n.y-t)**2),r=Math.cbrt(n.mass)*10;return i<r});return a==-1&&(a=window.data.particles.findIndex(n=>{const i=Math.sqrt((n.x-e)**2+(n.y-t)**2),r=15+Math.cbrt(n.mass)*10;return i<r})),a}b.addEventListener("mousedown",function(e){const t=b.getBoundingClientRect(),a=b.width/t.width,n=b.height/t.height,i=(e.clientX-t.left)*a,r=(e.clientY-t.top)*n,o=Te(i,r);o!==-1?(R=o,b.style.cursor="move"):(startX=e.clientX-b.offsetLeft,startY=e.clientY-b.offsetTop)});b.addEventListener("mousemove",function(e){if(R!==null){const t=b.getBoundingClientRect(),a=b.width/t.width,n=b.height/t.height,i=(e.clientX-t.left)*a,r=(e.clientY-t.top)*n;window.data.particles[R].x=i,window.data.particles[R].y=r,_()}});b.addEventListener("mouseup",function(e){R!==null&&(C(),R=null,b.style.cursor="default")});b.addEventListener("mouseleave",function(e){R!==null&&(C(),R=null,b.style.cursor="default")});function Ae(){localStorage.setItem("mechanismData",JSON.stringify(window.data))}function je(){const e=localStorage.getItem("mechanismData");if(e){window.data=JSON.parse(e),ve(window.data);try{C()}catch{fe({value:"Hinged Counterweight"})}}else fe({value:"Hinged Counterweight"})}window.addEventListener("resize",ye);window.onload=()=>{je(),ye(),fetch("https://apj.hgreer.com/jstreb",{method:"GET",cache:"no-store",mode:"no-cors"})};let re=!1;async function It(){if(re){re=!1,document.getElementById("optimize").innerText="Optimize";return}document.getElementById("optimize").innerText="Stop",re=!0;function e(){var r=[];for(var o of window.data.particles.slice(1))o.x%10!=0&&r.push(o.x),o.y%10!=0&&r.push(o.y),o.mass%1!=0&&r.push(o.mass);return r}function t(r){var o=0;for(var s of window.data.particles.slice(1))s.x%10!=0&&(s.x=r[o],o+=1),s.y%10!=0&&(s.y=r[o],o+=1),s.mass%1!=0&&(s.mass=Math.abs(r[o]),o+=1)}const a=e(),i=await Ee({initialConfig:a,objectiveFunction:r=>{t(r);var[s,o,s,c]=Q();return o},shouldStop:()=>!re,onImprovement:async()=>{_(),await Pe()},initialStepSize:.1,populationMultiplier:25,improvementCheckInterval:15});t(i),_()}var se=!1;async function Lt(){if(se){se=!1,document.getElementById("gentlify").innerText="Gentlify";return}document.getElementById("gentlify").innerText="Stop",se=!0;function e(){var o=[];for(var s of window.data.particles.slice(1))s.x%10!=0&&o.push(s.x),s.y%10!=0&&o.push(s.y),s.mass%1!=0&&o.push(s.mass);return o}function t(o){var s=0;for(var c of window.data.particles.slice(1))c.x%10!=0&&(c.x=o[s],s+=1),c.y%10!=0&&(c.y=o[s],s+=1),c.mass%1!=0&&(c.mass=Math.abs(o[s]),s+=1)}const a=e(),n=+document.getElementById("range").innerText,r=await Ee({initialConfig:a,objectiveFunction:o=>{t(o);var[c,s,c,l]=Q();return s<n?-1e16:-l},shouldStop:()=>!se,onImprovement:async()=>{_(),await Pe()},initialStepSize:.6,populationMultiplier:25,improvementCheckInterval:1});t(r),_()}function zt(){const e=new Blob([JSON.stringify(window.data)],{type:"application/json"}),t=prompt("Enter a filename for your window.data:","window.data.json");if(!t){alert("Save cancelled.");return}const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}function Tt(){const e=document.createElement("input");e.type="file",e.onchange=t=>{const a=t.target.files[0],n=new FileReader;n.onload=i=>{try{window.data=JSON.parse(i.target.result),ve(window.data),C()}catch{alert("Error parsing JSON!")}},n.readAsText(a)},document.body.appendChild(e),e.click(),document.body.removeChild(e)}window.doAnimate=yt;window.terminate=ge;window.drawMechanism=_;window.createParticle=xt;window.updateParticle=bt;window.deleteParticle=$t;window.createConstraint=Mt;window.updateConstraint=Pt;window.deleteConstraint=St;window.resizeCanvas=ye;window.updateUI=C;window.loadPreset=fe;window.createParticleControlBox=Le;window.constraintExists=le;window.createConstraintControlBox=ze;window.getParticleAtPosition=Te;window.saveMechanism=Ae;window.loadMechanism=je;window.optimize=Lt;window.optimizeRange=It;window.save=zt;window.load=Tt;window.updatePulley=Ct;window.updatePulleyDirection=_t;window.addPulley=Et;window.removePulley=kt;window.waitForAnimationFrame=Se;window.doit=gt;
