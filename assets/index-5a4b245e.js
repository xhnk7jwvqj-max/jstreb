(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();function ce(){this.one_d_arrays=[],this.two_d_arrays=[],this.zero_time=0}ce.prototype.getVec=function(t){this.one_d_arrays[t]===void 0&&(this.one_d_arrays[t]={index:0,zero_time:this.zero_time,backing:new Array(100).fill(0).map(()=>Array(t))});var e=this.one_d_arrays[t];return e.zero_time!=this.zero_time&&(e.index=0,e.zero_time=this.zero_time),e.index+=1,e.backing[e.index-1]};ce.prototype.getMat=function(t,e){this.two_d_arrays[t]===void 0&&(this.two_d_arrays[t]=[]),this.two_d_arrays[t][e]===void 0&&(this.two_d_arrays[t][e]={index:0,zero_time:this.zero_time,backing:new Array(100).fill(0).map(()=>Array(t).fill(0).map(()=>new Array(e)))});var n=this.two_d_arrays[t][e];n.zero_time!=this.zero_time&&(n.index=0,n.zero_time=this.zero_time),n.index+=1;var a=n.backing[n.index-1];return a};ce.prototype.clear=function(){this.zero_time+=1};const q=new ce;function ze(t,e){const n=t.length,a=q.getMat(n,n);let i=q.getVec(n);for(var r=0;r<t.length;r++)i[r]=t[r][0];for(let d=0;d<n;d++){var o=t[d];for(let f=0;f<n;f++){var s=0,c=i[d]&i[f];if(c)for(var l=e[f];c;){var p=31-Math.clz32(c);c=c-(1<<p),s+=o[p+1]*l[p+1]}a[d][f]=s}}return a}function Ae(t,e){const n=t.length,a=t[0].length,i=q.getMat(n,a);for(let s=0;s<n;s++){let c=i[s],l=t[s];c[0]=l[0];for(var r=c[0];r;){var o=31-Math.clz32(r);r=r-(1<<o),c[o+1]=l[o+1]/e[o]}}return i}function je(t,e){const n=t.length,a=t[0].length,i=q.getMat(n,a);for(let r=0;r<n;r++){let o=i[r],s=t[r];for(let c=0;c<a;c++)o[c]=s[c]/e[c]}return i}function T(t,e){return[t[0]-e[0],t[1]-e[1]]}function Be(t,e){return new Array(t.length).fill(0).map((n,a)=>t[a]-e[a])}function Re(t,e){const n=t.length,a=t[0].length,i=e.length,r=e[0].length-1;a!=i&&(console.log(a),console.log(i),assert(a==i));const o=new Array(n).fill(0).map(()=>new Array(r).fill(0));for(let l=0;l<n;l++)for(let p=0;p<a;p++)for(var s=e[p][0];s;){var c=31-Math.clz32(s);s=s-(1<<c),o[l][c]+=t[l][p]*e[p][c+1]}return o}function Fe(t,e){const n=t.length;for(let o=0;o<n;o++){let s=Math.abs(t[o][o]),c=o;for(let d=o+1;d<n;d++)Math.abs(t[d][o])>s&&(s=Math.abs(t[d][o]),c=d);const l=t[c];t[c]=t[o],t[o]=l;const p=e[c];e[c]=e[o],e[o]=p;var a=t[o];for(let d=o+1;d<n;d++){var i=t[d];const f=-i[o]/a[o];i[o]=0;for(let m=o+1;m<n;m++)i[m]+=f*a[m];e[d]+=f*e[o]}}const r=new Array(n).fill(0);for(let o=n-1;o>-1;o--){r[o]=e[o]/t[o][o];for(let s=o-1;s>-1;s--)e[s]-=t[s][o]*r[o]}return r}function Oe(t){for(var e=0,n=0;n<t.length;n++)e=Math.max(Math.abs(t[n]),e);return e}function $e(t,e){for(var n=new Array(t.length),a=0;a<t.length;a++)n[a]=t[a]-e[a];return n}function y(t,e){for(var n=new Array(t.length),a=0;a<t.length;a++)n[a]=t[a]+e[a];return n}function v(t,e){if(Array.isArray(t)){var n=e;e=t,t=n}for(var a=new Array(e.length),i=0;i<e.length;i++)a[i]=t*e[i];return a}function he(t,e,n,a,i,r,o){this.x=t,this.y=e,this.f=n,this.ymid=a,this.iterations=i,this.events=o,this.message=r}he.prototype._at=function(g,n){function a(B){return B*B}var i=this,r=i.x,o=i.y,s=i.f,c=i.ymid;r.length;var l,p,d,f,m,x,g,$,R=.5,F,D,I;return l=r[n],p=r[n+1],f=o[n],m=o[n+1],$=p-l,d=l+R*$,x=c[n],F=$e(s[n],v(f,1/(l-d)+2/(l-p))),D=$e(s[n+1],v(m,1/(p-d)+2/(p-l))),I=[a(g-p)*(g-d)/a(l-p)/(l-d),a(g-l)*a(g-p)/a(l-d)/a(p-d),a(g-l)*(g-d)/a(p-l)/(p-d),(g-l)*a(g-p)*(g-d)/a(l-p)/(l-d),(g-p)*a(g-l)*(g-d)/a(l-p)/(p-d)],y(y(y(y(v(f,I[0]),v(x,I[1])),v(m,I[2])),v(F,I[3])),v(D,I[4]))};he.prototype.at=function(e){var n,a,i,r=Math.floor;if(typeof e!="number"){var o=e.length,s=Array(o);for(n=o-1;n!==-1;--n)s[n]=this.at(e[n]);return s}var c=this.x;for(n=0,a=c.length-1;a-n>1;)i=r(.5*(n+a)),c[i]<=e?n=i:a=i;return this._at(e,n)};function Ne(t,e,n,a,i,r,o){typeof i>"u"&&(i=1e-6),typeof r>"u"&&(r=1e3);var s=[t],c=[n],l=[a(t,n)],p,d,f,m,x,g,$=[],R=1/5,F=[3/40,9/40],D=[44/45,-56/15,32/9],I=[19372/6561,-25360/2187,64448/6561,-212/729],B=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],W=[35/384,0,500/1113,125/192,-2187/6784,11/84],J=[.5*6025192743/30085553152,0,.5*51252292925/65400821598,.5*-2691868925/45128329728,.5*187940372067/1594534317056,.5*-1776094331/19743644256,.5*11237099/235043384],V=[1/5,3/10,4/5,8/9,1,1],H=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],M=0,Z,z,u=(e-t)/10,ee=0,O,G,xe=Math.min,Te=Math.abs,be=Math.pow,te=te,N=N,ae=ae,k,P,U,S=new he(s,c,l,$,-1,"");for(typeof o=="function"&&(k=o(t,n));t<e&&ee<r;){if(++ee,t+u>e&&(u=e-t),p=a(t+V[0]*u,y(n,v(R*u,l[M]))),d=a(t+V[1]*u,y(y(n,v(F[0]*u,l[M])),v(F[1]*u,p))),f=a(t+V[2]*u,y(y(y(n,v(D[0]*u,l[M])),v(D[1]*u,p)),v(D[2]*u,d))),m=a(t+V[3]*u,y(y(y(y(n,v(I[0]*u,l[M])),v(I[1]*u,p)),v(I[2]*u,d)),v(I[3]*u,f))),x=a(t+V[4]*u,y(y(y(y(y(n,v(B[0]*u,l[M])),v(B[1]*u,p)),v(B[2]*u,d)),v(B[3]*u,f)),v(B[4]*u,m))),O=y(y(y(y(y(n,v(l[M],u*W[0])),v(d,u*W[2])),v(f,u*W[3])),v(m,u*W[4])),v(x,u*W[5])),g=a(t+u,O),Z=y(y(y(y(y(v(l[M],u*H[0]),v(d,u*H[2])),v(f,u*H[3])),v(m,u*H[4])),v(x,u*H[5])),v(g,u*H[6])),typeof Z=="number"?G=Te(Z):G=Oe(Z),G>i){if(u=.2*u*be(i/G,.25),t+u===t){S.msg="Step size became too small";break}continue}if($[M]=y(y(y(y(y(y(n,v(l[M],u*J[0])),v(d,u*J[2])),v(f,u*J[3])),v(m,u*J[4])),v(x,u*J[5])),v(g,u*J[6])),++M,s[M]=t+u,c[M]=O,l[M]=g,typeof o=="function"){var ne,K=t,A=t+.5*u,E;if(P=o(A,$[M-1]),U=ae(N(k,0),N(0,P)),te(U)||(K=A,A=t+u,k=P,P=o(A,O),U=ae(N(k,0),N(0,P))),te(U)){for(var pe,oe,ie=0,X=1,Y=1;;){if(typeof k=="number")E=(Y*P*K-X*k*A)/(Y*P-X*k);else for(E=A,z=k.length-1;z!==-1;--z)k[z]<0&&P[z]>0&&(E=xe(E,(Y*P[z]*K-X*k[z]*A)/(Y*P[z]-X*k[z])));if(E<=K||E>=A)break;ne=S._at(E,M-1),oe=o(E,ne),pe=ae(N(k,0),N(0,oe)),te(pe)?(A=E,P=oe,U=pe,Y=1,ie===-1?X*=.5:X=1,ie=-1):(K=E,k=oe,X=1,ie===1?Y*=.5:Y=1,ie=1)}return O=S._at(.5*(t+E),M-1),S.f[M]=a(E,ne),S.x[M]=E,S.y[M]=ne,S.ymid[M-1]=O,S.events=U,S.iterations=ee,S}}t+=u,n=O,k=P,u=xe(.8*u*be(i/G,.25),4*u)}return S.iterations=ee,S}const we=2;function me(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]}function ue(t,e){return t[0]*e[1]-t[1]*e[0]}function h(t,e){return[t[2*e],t[2*e+1]]}function Xe(t,e,n){t[2*n]=e[0],t[2*n+1]=e[1]}function L(t,e,n){t[0]|=3<<2*n,t[2*n+1]=e[0],t[2*n+2]=e[1]}function Ye(t,e,n){this.p1=t,this.p2=e,this.oneway=n,this.name="Rod"}function qe(t,e,n){this.p1=t,this.p2=JSON.parse(JSON.stringify(e)),this.p3=n,this.name="Rope"}function De(t,e,n){this.reference=t,this.slide=e,this.base=n,this.fatmode=!1,this.name="F2k"}function Je(t,e,n,a){this.reference=t,this.slide=e,this.base=n,this.oneway=a,this.name="Colinear"}function de(t,e,n){this.p=t,this.n=me(e),this.oneway=n,this.name="Slider"}function He(t,e,n,a){this.forces=Array(e.length).fill([0,-1]).flat(),this.constraints=t,this.masses=e.flatMap(i=>[i,i]),this.positions=n,this.velocities=a}function Ue(t){let e={rod:[],slider:[],colinear:[],f2k:[],rope:[],pin:[]};for(let n of t)if(n.oneway!=we)switch(n.name){case"Rod":e.rod.push({p1:n.p1,p2:n.p2,oneway:n.oneway});break;case"Slider":e.slider.push({p:n.p,normal:{x:n.n[0],y:n.n[1]},oneway:n.oneway});break;case"Colinear":e.colinear.push({reference:n.reference,slider:n.slide,base:n.base,oneway:n.oneway});break;case"F2k":e.f2k.push({reference:n.reference,slider:n.slide,base:n.base});break;case"Rope":e.rope.push({p1:n.p1,pulleys:n.p2.filter(a=>a.wrapping!="cw_drop"&&a.wrapping!="ccw_drop"),p3:n.p3});break}return e}function Me(t,e,n,a,i){let r=[],o=[],s=[];for(var c of t)r.push(c.mass),o.push(c.x),o.push(c.y);for(var l of e.rod)s.push(new Ye(l.p1,l.p2,l.oneway));for(var p of e.slider)s.push(new de(p.p,[p.normal.x,p.normal.y],p.oneway));for(var p of e.pin)s.push(new de(p.p,[0,1],!1)),s.push(new de(p.p,[1,0],!1));for(var d of e.colinear)s.push(new Je(d.reference,d.slider,d.base,d.oneway));for(var f of e.f2k)s.push(new De(f.reference,f.slider,f.base));for(var m of e.rope)s.push(new qe(m.p1,m.pulleys.slice(),m.p3));var x=new He(s,r,o,new Array(o.length).fill(0));x.terminate=i;let g=x.positions.concat(x.velocities);return We(x,g,n,a)}function We(t,e,n,a){for(var i=[],r=[],o=[],s=(d,f)=>{for(q.clear();d<i[i.length-1];){i.pop();var m=r.pop();t.constraints=JSON.parse(m),t.stringConstraint=m}return i.push(d),0|!t.stringConstraint&&(t.stringConstraint=JSON.stringify(t.constraints)),r.push(t.stringConstraint),o.push(t.constraintForces),Ge(t,f)[0]},c=Ne(0,a,e,s,1e-6,1e4),l=[],p=0;p<a;)l.push(c.at(p)),p+=n;return[l,[i,r],o]}function Ve(t){for(var e=q.getMat(t.constraints.length,t.masses.length+1),n=0;n<t.constraints.length;n++){var a=t.constraints[n],i=e[n];i[0]=0,a.oneway!==we&&(a.name==="Rod"&&Ke(i,a,t),a.name==="Slider"&&Qe(i,a),a.name==="Colinear"&&nt(i,a,t),a.name==="F2k"&&it(i,a,t),a.name==="Rope"&&et(i,a,t))}var r=Ae(e,t.masses);r=ze(r,e);for(var o=0;o<r.length;o++)r[o][o]==0&&(r[o][o]=1);for(var s=q.getVec(t.constraints.length),n=0;n<t.constraints.length;n++){var a=t.constraints[n];a.name==="Rod"&&(s[n]=Ze(a,t)),a.name==="Slider"&&(s[n]=at(a,t)),a.name==="Colinear"&&(s[n]=ot(a,t)),a.name==="F2k"&&(s[n]=rt(a,t)),a.name==="Rope"&&(s[n]=tt(a,t))}let c=Fe(r,s);t.constraintForces=c;for(var o=0;o<c.length;o++)t.constraints[o].force=c[o];let l=Be(je(Re([c],e),t.masses)[0],t.forces);for(var o=0;o<c.length;o++)if(c[o]>0&&t.constraints[o].oneway===!0){t.constraints[o].oneway=we,t.stringConstraint=null;break}return[l,!1]}function Ge(t,e){t.positions=e.slice(0,t.positions.length),t.velocities=e.slice(t.positions.length,e.length);let[n,a]=Ve(t);if(t.terminate(e)){for(var i=window.data.projectile,r=0;r<t.constraints.length;r++)if(t.constraints[r].p1===i||t.constraints[r].p2===i||t.constraints[r].p3===i){t.constraints.splice(r,1),t.stringConstraint=null;break}}return[t.velocities.concat(n),!1]}function Ke(t,e,n){let a=me(T(h(n.positions,e.p1),h(n.positions,e.p2)));return L(t,a,e.p2),L(t,[-a[0],-a[1]],e.p1),t}function Qe(t,e,n){return L(t,e.n,e.p),t}function Ze(t,e){let n=T(h(e.positions,t.p1),h(e.positions,t.p2)),a=T(h(e.velocities,t.p1),h(e.velocities,t.p2)),i=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return(a[0]*a[0]+a[1]*a[1])/i}function et(t,e,n){var a=[];a.push(e.p1);for(var i of e.p2)a.push(i.idx);a.push(e.p3);for(var r=1;r<a.length-1;r++)if(e.p2[r-1].wrapping=="ccw_drop"||e.p2[r-1].wrapping=="cw_drop"){for(var o=r-1;o>1&&(e.p2[o-1].wrapping=="ccw_drop"||e.p2[o-1].wrapping=="cw_drop");)o-=1;for(var s=r+1;s<a.length-2&&(e.p2[s-1].wrapping=="ccw_drop"||e.p2[s-1].wrapping=="cw_drop");)s+=1;var c=h(n.positions,a[o]),l=h(n.positions,a[r]),p=h(n.positions,a[s]),d=ue(T(c,l),T(l,p));if(d>0&&e.p2[r-1].wrapping=="ccw_drop"||d<0&&e.p2[r-1].wrapping=="cw_drop"){e.p2[r-1].wrapping="both",n.stringConstraint=null;break}}a=[],a.push(e.p1);for(var i of e.p2)i.wrapping!="ccw_drop"&&i.wrapping!="cw_drop"&&a.push(i.idx);a.push(e.p3);for(var r=1;r<a.length-1;r++){var c=h(n.positions,a[r-1]),l=h(n.positions,a[r]),p=h(n.positions,a[r+1]),d=ue(T(c,l),T(l,p));if(d>0&&e.p2[r-1].wrapping=="ccw"||d<0&&e.p2[r-1].wrapping=="cw"){e.p2.splice(r-1,1),n.stringConstraint=null;break}}a=[],a.push(e.p1);for(var i of e.p2)i.wrapping!="ccw_drop"&&i.wrapping!="cw_drop"&&a.push(i.idx);a.push(e.p3),t.fill(0);for(var r=0;r<a.length-1;r++){let m=a[r],x=a[r+1],g=me(T(h(n.positions,m),h(n.positions,x))),$=h(t,m+.5);L(t,T($,g),m),L(t,g,x)}return t}function tt(t,e){var n=0,a=[];a.push(t.p1);for(var i of t.p2)i.wrapping!="ccw_drop"&&i.wrapping!="cw_drop"&&a.push(i.idx);a.push(t.p3);for(var r=0;r<a.length-1;r++){let o=a[r],s=a[r+1],c=T(h(e.positions,o),h(e.positions,s)),l=T(h(e.velocities,o),h(e.velocities,s)),p=Math.sqrt(c[0]*c[0]+c[1]*c[1]);n+=Math.pow(ue(c,l),2)/(p*p*p)}return n}function at(t,e){var n=h(e.forces,t.p);return t.n[0]*n[0]+t.n[1]*n[1]}function nt(t,e,n){var[a,i]=h(n.positions,e.slide);h(n.velocities,e.slide);var[r,o]=h(n.positions,e.reference);h(n.velocities,e.reference);var[s,c]=h(n.positions,e.base);h(n.velocities,e.base),a=a-s,i=i-c,r=r-s,o=o-c;var l=Math.sqrt(r*r+o*o),p=l*l*l,d=-o/l,f=r/l,m=(a*r*o+i*o*o)/p,x=-(a*r*r+r*i*o)/p,g=-d-m,$=-f-x;return L(t,[d,f],e.slide),L(t,[m,x],e.reference),L(t,[g,$],e.base),t}function ot(t,e){var[n,a]=h(e.positions,t.slide),[i,r]=h(e.velocities,t.slide),[o,s]=h(e.positions,t.reference),[c,l]=h(e.velocities,t.reference),[p,d]=h(e.positions,t.base),[f,m]=h(e.velocities,t.base);n=n-p,a=a-d,i=i-f,r=r-m,o=o-p,s=s-d,c=c-f,l=l-m;var x=Math.sqrt(o*o+s*s),g=o/x,$=s/x,R=(l*g-c*$)*(((2*c*n-l*a)*g*g+(l*n+c*a)*3*g*$+(2*l*a-c*n)*$*$)/(x*x)-2*(i*g+r*$)/x);return-R}function it(t,e,n){var[a,i]=h(n.positions,e.slide);h(n.velocities,e.slide);var[r,o]=h(n.positions,e.reference);h(n.velocities,e.reference);var[s,c]=h(n.positions,e.base);if(h(n.velocities,e.base),a=a-s,i=i-c,r=r-s,o=o-c,o<0){if(!e.fatmode){var l=a,p=r-a;e.ratio=l/p}e.fatmode=!0,n.stringConstraint=null}if(e.fatmode)return L(t,[0,1],e.base),L(t,[0,e.ratio],e.reference),t;var d=Math.sqrt(r*r+o*o),f=d*d*d,m=-o/d,x=r/d,g=(a*r*o+i*o*o)/f,$=-(a*r*r+r*i*o)/f,R=-m-g,F=-x-$;return L(t,[m,x],e.slide),L(t,[g,$],e.reference),Xe(t,[R,F],e.base),t}function rt(t,e){if(t.fatmode)return-1-t.ratio;var[n,a]=h(e.positions,t.slide),[i,r]=h(e.velocities,t.slide),[o,s]=h(e.positions,t.reference),[c,l]=h(e.velocities,t.reference),[p,d]=h(e.positions,t.base),[f,m]=h(e.velocities,t.base);n=n-p,a=a-d,i=i-f,r=r-m,o=o-p,s=s-d,c=c-f,l=l-m;var x=Math.sqrt(o*o+s*s),g=(2*c*n*o*o-2*i*o*o*o-l*o*o*a+3*l*n*o*s-2*r*o*o*s+3*c*o*a*s-c*n*s*s-2*i*o*s*s+2*l*a*s*s-2*r*s*s*s)*(l*o-c*s)/(x*x*x*x*x);return-g}const st=["rod","pin","slider","colinear","f2k","rope"];function ve(t){for(const n of st)t.constraints[n]===void 0&&(t.constraints[n]=[]);const e=t.particles.map(()=>0);t.constraints.slider.forEach(n=>{n.oneway||(e[n.p]+=1)}),t.constraints.slider=t.constraints.slider.filter(n=>e[n.p]<2),t.constraints.pin=t.constraints.pin.concat(e.flatMap((n,a)=>[{count:n,p:a}]).filter(n=>n.count>1))}function lt(t){return Math.max(...t.slice(1).map(e=>Math.max(...e.map(n=>Math.abs(n)))))}function ct(t,e){let n=-e.particles[e.mainaxle].y,a=-e.particles[e.mainaxle].y,i=0;for(const s of t){for(let c=0;c<e.particles.length;c++)s[2*c]<2e3&&(a=Math.min(a,-s[2*c+1])),n=Math.max(n,-s[2*e.mainaxle+1]);i=Math.max(i,2*Math.max(0,-s[2*e.particles.length+2*e.projectile+1])*s[2*e.particles.length+2*e.projectile])}const r=n-a,o=Math.sqrt(Math.pow(e.particles[e.armtip].x-e.particles[e.mainaxle].x,2)+Math.pow(e.particles[e.armtip].y-e.particles[e.projectile].y,2));return i=i/Math.max(r,.75*o)*e.axleheight,i}const Ce={"Hinged Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":588,"y":440.7,"mass":10},{"x":668,"y":673.6,"mass":1},{"x":586,"y":533.7,"mass":100}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Fixed Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":668,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Floating Arm Trebuchet":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":487.0,"y":517.0,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":589,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',F2k:'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.6,"duration":35,"particles":[{"x":454,"y":516,"mass":1},{"x":436.6,"y":513.0,"mass":4},{"x":560.3,"y":211.5,"mass":100},{"x":652.9,"y":621.8,"mass":1}],"constraints":{"rod":[{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":1,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":0,"normal":{"x":0,"y":1}}],"colinear":[],"f2k":[{"reference":1,"slider":0,"base":2}],"rope":[]}}',"Floating Arm Whipper (NASAW)":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":37,"particles":[{"x":496.3,"y":477.6,"mass":1},{"x":677.5,"y":471.0,"mass":4},{"x":468.0,"y":453.5,"mass":10},{"x":557.0,"y":431.8,"mass":1},{"x":563.0,"y":340.7,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":4,"normal":{"x":0.6,"y":0}}],"colinear":[]}}',Whipper:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3,"duration":60,"particles":[{"x":536,"y":472.7,"mass":1},{"x":759,"y":451,"mass":4},{"x":483,"y":498,"mass":10},{"x":551,"y":434,"mass":1},{"x":560,"y":368,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":0}}]}}',Fiffer:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":20,"particles":[{"x":536,"y":472.7,"mass":1},{"x":484,"y":656,"mass":4},{"x":504,"y":433,"mass":10},{"x":644,"y":661,"mass":1},{"x":653,"y":451,"mass":10},{"x":749,"y":428,"mass":1},{"x":749,"y":483,"mass":500},{"x":566,"y":505,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":7,"p2":6},{"p1":6,"p2":4},{"p1":4,"p2":5}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":7,"normal":{"x":0.7,"y":1}},{"p":7,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0.7,"y":1}}]}}',"Floating Arm King Arthur":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":40,"particles":[{"x":536,"y":472.7,"mass":1},{"x":527,"y":610,"mass":4},{"x":534,"y":418,"mass":10},{"x":698,"y":608,"mass":1},{"x":560,"y":331,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":-0.5,"y":0},"oneway":true},{"p":1,"normal":{"x":0.7,"y":0},"oneway":true},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Launch Ness Monster":'{"projectile":3,"mainaxle":2,"armtip":1,"axleheight":8,"timestep":0.3,"duration":80,"particles":[{"x":600.7,"y":746.2,"mass":10},{"x":559.1,"y":774.0,"mass":4},{"x":660.2,"y":530.0,"mass":100},{"x":703.9,"y":796.7,"mass":1},{"x":810,"y":530,"mass":10},{"x":552,"y":500,"mass":10},{"x":458,"y":666,"mass":10},{"x":886.1,"y":662.4,"mass":10}],"constraints":{"rod":[{"p1":2,"p2":1},{"p1":3,"p2":1},{"p1":6,"p2":5},{"p1":5,"p2":2},{"p1":4,"p2":2},{"p1":4,"p2":7},{"p1":5,"p2":4}],"slider":[{"p":0,"normal":{"x":1,"y":2.1}},{"p":0,"normal":{"x":-0.6,"y":1.6}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":6,"normal":{"x":0.6,"y":1}},{"p":6,"normal":{"x":0,"y":1}},{"p":7,"normal":{"x":1,"y":1}},{"p":7,"normal":{"x":0,"y":1}}],"colinear":[{"reference":1,"slider":0,"base":2}]}}',"Pulley Sling":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":35,"particles":[{"x":546.3,"y":584.3,"mass":1},{"x":285.6,"y":791.6,"mass":4},{"x":560.6,"y":481.2,"mass":10},{"x":1000.9,"y":742.8,"mass":1},{"x":645.5,"y":541.0,"mass":500},{"x":72.7,"y":730.2,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":5,"normal":{"x":1,"y":1}},{"p":5,"normal":{"x":0,"y":1}}],"colinear":[],"rope":[{"p1":5,"pulleys":[{"idx":1,"wrapping":"both"}],"p3":3}]}}',MURLIN:'{"projectile":8,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.1,"duration":40,"particles":[{"x":510.98330181224014,"y":585.0346326615387,"mass":1,"hovered":false},{"x":610.8818474508025,"y":509.1784380643879,"mass":1,"hovered":false},{"x":530.7749198606792,"y":582.2639014087384,"mass":1,"hovered":false},{"x":508.2352941176471,"y":627.2941140567556,"mass":1,"hovered":false},{"x":437.64705882352945,"y":593.176466997932,"mass":1,"hovered":false},{"x":477.64705882352945,"y":495.5294081744026,"mass":1,"hovered":false},{"x":648.2352941176471,"y":446.1176434685202,"mass":1,"hovered":false},{"x":648.2352941176471,"y":464.94117288028497,"mass":200,"hovered":false},{"x":462.2625079139531,"y":570.2700562274708,"mass":1,"hovered":false}],"constraints":{"rod":[{"p1":2,"p2":1,"hovered":false},{"p1":2,"p2":0,"hovered":false},{"p1":1,"p2":0,"hovered":false},{"p1":3,"p2":2,"hovered":false},{"p1":3,"p2":0,"hovered":false},{"p1":4,"p2":3,"hovered":false},{"p1":4,"p2":0,"hovered":false},{"p1":5,"p2":4,"hovered":false},{"p1":5,"p2":0,"hovered":false},{"p1":8,"p2":1,"hovered":false},{"p1":8,"p2":0,"hovered":false,"oneway":true}],"slider":[],"colinear":[],"f2k":[],"rope":[{"p1":7,"pulleys":[{"idx":6,"wrapping":"ccw"},{"idx":5,"wrapping":"ccw"},{"idx":4,"wrapping":"ccw"},{"idx":3,"wrapping":"ccw"}],"p3":2,"hovered":false}],"pin":[{"count":2,"p":0},{"count":2,"p":6}]}}'};var pt=["rod","pin","slider","colinear","f2k","rope"];const b=document.getElementById("mechanism");b.addEventListener("touchstart",function(t){var e=t.touches[0],n=new MouseEvent("mousedown",{clientX:e.clientX,clientY:e.clientY});b.dispatchEvent(n)});b.addEventListener("touchend",function(t){var e=new MouseEvent("mouseup",{});b.dispatchEvent(e)});b.addEventListener("touchmove",function(t){if(!(t.touches.length>1)&&j!==null){t.preventDefault();var e=t.touches[0],n=new MouseEvent("mousemove",{clientX:e.clientX,clientY:e.clientY});b.dispatchEvent(n)}});const w=b.getContext("2d");window.data={duration:50,timestep:1,projectile:3,mainaxle:0,armtip:1,axleheight:8,particles:[{x:100,y:100,mass:1,hovered:!1}],constraints:{rod:[],slider:[]}};async function dt(){for(var t=0;t<600;t+=5)for(var e=300;e<900;e+=5){window.data.particles[5].x=t,window.data.particles[5].y=e;var[n,a,i,r]=Q();w.beginPath(),w.arc(t,e,4,0,Math.PI*2);var o=256*a/4e4;w.fillStyle=`rgb(${o}, ${256*Math.sin(o/10)}, ${o})`,w.fill(),e%50==0&&await window.waitForAnimationFrame()}}async function _e(){return new Promise(t=>{setTimeout(()=>{t()},1)})}async function ke(){await new Promise(t=>{requestAnimationFrame(()=>{t()})})}async function wt(){if(window.data.timestep!=0){var t=JSON.stringify(window.data),[e,n,a]=Me(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,ge),i=window.data.timestep;window.data.timestep=0;var r=0,o=0;for(var s of e){for(;n[0][o+1]<r;)o+=1;r+=i;var c=JSON.parse(n[1][o]);window.data.constraints=Ue(c);for(var l=0;l<window.data.particles.length;l++)window.data.particles[l].x=s[2*l],window.data.particles[l].y=s[2*l+1];_(),await ke()}window.data=JSON.parse(t),_()}}function ge(t){t[2*window.data.armtip]-t[2*window.data.projectile],t[2*window.data.armtip+1]-t[2*window.data.projectile+1],t[2*window.data.armtip]-t[2*window.data.mainaxle],t[2*window.data.armtip+1]-t[2*window.data.mainaxle+1];var e=t[2*window.data.projectile+2*window.data.particles.length],n=t[2*window.data.projectile+2*window.data.particles.length+1];return e>40&&n>0}function Q(){var t=Date.now();const[e,n,a]=Me(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,ge);window.constraintLog=n,console.log(a);var i=lt(a),r=ct(e,window.data),o=Date.now();return document.getElementById("simtime").innerText=o-t,[e,r,n,i]}function _(){if(Le(),w.save(),w.setTransform(1,0,0,1,0,0),w.clearRect(0,0,b.width,b.height),w.restore(),w.setTransform(1,0,0,1,0,0),window.data.particles.length>1&&window.data.constraints.rod.length+window.data.constraints.slider.length>1&&window.data.timestep>0&&typeof window.data.timestep=="number"){var[t,e,n,a]=Q();document.getElementById("range").innerText=e.toFixed(1),document.getElementById("peakLoad").innerText=a.toFixed(1);var i=0,r=0;t.forEach(o=>{for(;n[0][r+1]<i;)r+=1;i+=window.data.timestep;for(let l=0;l<window.data.constraints.rod.length;l++)if(window.data.constraints.rod[l].oneway!=!0){const p=window.data.constraints.rod[l],d=p.p1*2,f=p.p2*2;w.beginPath(),w.moveTo(o[d],o[d+1]),w.lineTo(o[f],o[f+1]),w.strokeStyle="rgba(255, 0, 0, 0.2)",w.stroke()}for(let l=0;l<window.data.constraints.rope.length;l++)if(window.data.constraints.rope[l].oneway!=!0){const p=window.data.constraints.rope[l],d=p.p1*2,f=p.p3*2;w.beginPath(),w.moveTo(o[d],o[d+1]);for(var s of window.data.constraints.rope[l].pulleys){var c=s.idx*2;w.lineTo(o[c],o[c+1])}w.lineTo(o[f],o[f+1]),w.strokeStyle="rgba(255, 0, 0, 0.2)",w.stroke()}}),w.strokeStyle="black"}w.lineWidth=3,window.data.constraints.rod.forEach(o=>{const s=window.data.particles[o.p1],c=window.data.particles[o.p2];w.beginPath(),w.moveTo(s.x,s.y),w.lineTo(c.x,c.y),w.strokeStyle=o.hovered?"yellow":"black",w.stroke()}),window.data.constraints.rope.forEach(o=>{const s=window.data.particles[o.p1],c=window.data.particles[o.p3];w.setLineDash([8,8]),w.beginPath(),w.moveTo(s.x,s.y);for(var l of o.pulleys){const p=window.data.particles[l.idx];w.lineTo(p.x,p.y)}w.lineTo(c.x,c.y),w.strokeStyle=o.hovered?"yellow":"black",w.stroke(),w.setLineDash([])}),window.data.constraints.slider.concat(window.data.constraints.pin.flatMap(o=>[{p:o.p,normal:{x:0,y:1}},{p:o.p,normal:{x:1,y:0}}])).forEach(o=>{const s=window.data.particles[o.p],c=40,l=Math.atan2(o.normal.y,o.normal.x)+Math.PI/2;w.beginPath(),w.moveTo(s.x-c*Math.cos(l),s.y-c*Math.sin(l)),w.lineTo(s.x+c*Math.cos(l),s.y+c*Math.sin(l)),w.strokeStyle=o.hovered?"yellow":"black",w.stroke()}),window.data.constraints.colinear.concat(window.data.constraints.f2k).forEach(o=>{const s=window.data.particles[o.base],c=window.data.particles[o.reference],l=window.data.particles[o.slider],p=Math.sqrt((s.x-c.x)*(s.x-c.x)+(s.y-c.y)*(s.y-c.y)),d=(s.x-c.x)/p,f=(s.y-c.y)/p,m=Math.abs(d*(s.y-l.y)-f*(s.x-l.x));w.beginPath(),w.arc(l.x,l.y,m,0,Math.PI*2),w.strokeStyle="grey",w.stroke()}),w.lineWidth=1,window.data.particles.forEach((o,s)=>{const c=Math.cbrt(o.mass)*4;w.beginPath(),w.arc(o.x,o.y,c,0,Math.PI*2),w.fillStyle=o.hovered?"yellow":"black",w.strokeStyle="black",s==window.data.projectile&&(w.fillStyle="lightblue",w.strokeStyle="blue"),w.fill(),w.stroke(),w.font="18px Arial",w.textAlign="center",w.textBaseline="middle",w.fillStyle="black",w.fillText(`P${s+1}`,o.x,o.y-c-10)})}function ut(){const t={x:100,y:100,mass:1,hovered:!1};window.data.particles.push(t),C()}function ft(t,e,n){window.data.particles[t][e]=Number(n),_()}function ht(t){window.data.particles.splice(t,1);for(var e in window.data.constraints)for(var n=window.data.constraints[e],a=!1;!a;){a=!0;for(var i=0;i<n.length;i++){var r=n[i],o=!1;for(var s of["p","p1","p2","p3","reference","base","slider"])r[s]===t&&(o=!0);o&&(a=!1,n.splice(i,1))}}for(var s of["projectile","armtip","mainaxle"])window.data[s]===t&&(window.data[s]=0);C()}function mt(t){let e={};if(t==="rod"){if(window.data.particles.length<2){alert("At least two particles are required to create a rod constraint.");return}var n=[];for(let r=window.data.particles.length-1;r>=0;r--)for(let o=window.data.particles.length-1;o>=0;o--)le(r,o)||n.push([r,o]);e={p1:n[0][0],p2:n[0][1],hovered:!1},window.data.constraints.rod.push(e)}else if(t==="slider"){if(window.data.particles.length<1){alert("At least one particle is required to create a slider constraint.");return}var a=window.data.constraints.slider,i=window.data.particles.length-1;a.length>0&&a[a.length-1].p==i&&a[a.length-1].normal.x==0&&a[a.length-1].normal.y==1?e={p:i,normal:{x:1,y:0},hovered:!1}:e={p:i,normal:{x:0,y:1},hovered:!1},window.data.constraints.slider.push(e)}else if(t==="colinear")e={reference:0,slider:1,base:2},window.data.constraints.colinear.push(e);else if(t==="pin")e={p:window.data.particles.length-1},window.data.constraints.pin.push(e);else if(t==="f2k")e={reference:0,slider:1,base:2},window.data.constraints.f2k.push(e);else if(t==="rope")e={p1:0,pulleys:[],p3:2},window.data.constraints.rope.push(e);else{console.error("Unknown constraint type:",t);return}C()}function vt(t,e,n){const a=+t.value,i=window.data.constraints.rope[e];i.pulleys[n].idx=a,C()}function gt(t,e,n){const a=t.value,i=window.data.constraints.rope[e];i.pulleys[n].wrapping=a,C()}function yt(t){window.data.constraints.rope[t].pulleys.pop(),C()}function xt(t){window.data.constraints.rope[t].pulleys.push({idx:0,wrapping:"both"}),C()}function bt(t,e,n,a){const i=a.includes("normal")?parseFloat(t.value):parseInt(t.value),r=window.data.constraints[e][n];a==="p1"||a==="p2"||a==="p"?(r[a]=i,C()):a==="normalX"||a==="normalY"?(r.normal[a.slice(-1).toLowerCase()]=i,_()):(r[a]=i,C())}function $t(t,e){window.data.constraints[t].splice(e,1),C()}function ye(){var t=Math.min(window.screen.width,window.innerWidth);console.log(t),t>1040&&(t-=440),t=Math.min(t,window.innerHeight-130),t=Math.max(t,400),b.width=600*1.9,b.height=600*1.9,b.style.width=t+"px",b.style.height=t+"px",window.innerWidth-t>840?document.getElementById("allcontrols").style.flexDirection="row":document.getElementById("allcontrols").style.flexDirection="column",C()}function C(){_(),document.getElementById("timestep").value=window.data.timestep,document.getElementById("duration").value=window.data.duration;const t=document.getElementById("particlesControl");for(;t.children.length>1;)t.removeChild(t.lastChild);window.data.particles.forEach((l,p)=>Ee(p));const e=document.getElementById("constraintsControl");for(;e.children.length>1;)e.removeChild(e.lastChild);for(var n of pt)window.data.constraints[n].forEach((l,p)=>Pe(n,p));const a=document.getElementById("presets");for(;a.children.length>0;)a.removeChild(a.lastChild);const i=document.createElement("option");i.selected="true",i.innerHTML="Presets",a.appendChild(i);for(var r of Object.keys(Ce)){const l=document.createElement("option");l.innerHTML=r,l.value=r,a.appendChild(l)}for(var o of["armtip","projectile","mainaxle"]){for(var s=document.getElementById(o);s.children.length>0;)s.removeChild(s.lastChild);for(var c=0;c<window.data.particles.length;c++){const l=document.createElement("option");l.selected=window.data[o]==c,l.innerHTML=`P ${c+1}`,l.value=c,s.appendChild(l)}}document.getElementById("axleheight").value=window.data.axleheight}function fe(t){window.data=JSON.parse(Ce[t.value]),ve(window.data);var[e,n,n,n]=Q(),a=999,i=999,r=0,o=0;e.forEach(l=>{for(var p=0;p<l.length/2;p+=2){var d=l[p],f=l[p+1];a=Math.min(d,a),p/2!=window.data.projectile&&(r=Math.max(r,d)),d<1200&&(i=Math.min(f,i)),o=Math.max(f,o)}});var s=Math.max(r-a,o-i);window.data.duration=Math.round(window.data.duration*Math.sqrt(1/s*.8*600*1.9));for(var c of window.data.particles)c.x-=a,c.x/=s,c.x*=.8,c.x+=.1,c.x*=600*1.9,c.y-=i,c.y/=s,c.y*=.8,c.y+=.1,c.y*=600*1.9;C()}function Ee(t){const e=document.createElement("div");e.className="control-box",e.innerHTML=`
                P ${1+t} <label>Mass <input type="text" min="1" max="500" value="${window.data.particles[t].mass}" oninput="updateParticle(${t}, 'mass', this.value)"></label>
                <label>X <input type="text" min="0" max="${b.width}" value="${window.data.particles[t].x}" oninput="updateParticle(${t}, 'x', this.value)"></label>
                <label>Y <input type="text" min="0" max="${b.height}" value="${window.data.particles[t].y}" oninput="updateParticle(${t}, 'y', this.value)"></label>
                ${t==data.particles.length-1?`<button class=delete onclick="deleteParticle(${t})">X</button>`:""}
              `,e.addEventListener("mouseenter",()=>{window.data.particles[t].hovered=!0,_()}),e.addEventListener("mouseleave",()=>{window.data.particles[t].hovered=!1,_()}),document.getElementById("particlesControl").appendChild(e)}function le(t,e){if(t==e)return!0;for(var n of window.data.constraints.rod)if(n.p1==t&&n.p2==e||n.p1==e&&n.p2==t||t==e)return!0;return!1}function Pe(t,e){const n=document.createElement("div");if(n.className="control-box",n.dataset.type=t,n.dataset.index=e,t==="rod")n.innerHTML=`Rod
                    <select name="p1" onchange="updateConstraint(this, 'rod', ${e}, 'p1')">
            	   ${window.data.particles.map((a,i)=>i).filter(a=>!le(window.data.constraints.rod[e].p2,a)||a==window.data.constraints.rod[e].p1).map(a=>`<option value="${a}" ${a===window.data.constraints.rod[e].p1?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
                    <select name="p2" onchange="updateConstraint(this, 'rod', ${e}, 'p2')">
            	   ${window.data.particles.map((a,i)=>i).filter(a=>!le(window.data.constraints.rod[e].p1,a)||a==window.data.constraints.rod[e].p2).map(a=>`<option value="${a}" ${a===window.data.constraints.rod[e].p2?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    One way
            			<input type="checkbox" oninput="window.data.constraints.rod[${e}].oneway=this.checked;updateUI()" ${window.data.constraints.rod[e].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('rod', ${e})">X</button>
                `;else if(t==="slider"){const a=window.data.constraints.slider[e];n.innerHTML=`
                  <label>
            		Slider
                    <select name="p" onchange="updateConstraint(this, 'slider', ${e}, 'p')">
                      ${window.data.particles.map((i,r)=>`<option value="${r}" ${r===a.p?"selected":""}>P ${r+1}</option>`).join("")}
                    </select>
                  </label>
                  <label>Normal X <input type="range" name="normalX" min="-1" max="1" step="0.1" value="${a.normal.x}" oninput="updateConstraint(this, 'slider', ${e}, 'normalX')"></label>
                  <label>Normal Y <input type="range" name="normalY" min="-1" max="1" step="0.1" value="${a.normal.y}" oninput="updateConstraint(this, 'slider', ${e}, 'normalY')"></label>
		  One way
            			<input type="checkbox" oninput="window.data.constraints.slider[${e}].oneway=this.checked;updateUI()" ${window.data.constraints.slider[e].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('slider', ${e})">X</button>
                `}else t==="colinear"?n.innerHTML=`Roller Track1
                    <select name="reference" onchange="updateConstraint(this, 'colinear', ${e}, 'reference')">
            	   ${window.data.particles.map((a,i)=>i).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[e].reference?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Slide
                    <select name="slider" onchange="updateConstraint(this, 'colinear', ${e}, 'slider')">

            	   ${window.data.particles.map((a,i)=>i).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[e].slider?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Track2
                    <select name="base" onchange="updateConstraint(this, 'colinear', ${e}, 'base')">

            	   ${window.data.particles.map((a,i)=>i).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[e].base?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
            			<input type="checkbox" oninput="window.data.constraints.colinear[${e}].oneway=this.checked;updateUI()" ${window.data.constraints.colinear[e].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('colinear', ${e})">X</button>
                `:t==="pin"?n.innerHTML=`Pin <select onchange="updateConstraint(this, 'pin', ${e}, 'p')">${window.data.particles.map((a,i)=>`<option value="${i}" ${i===window.data.constraints.pin[e].p?"selected":""}>P ${i+1}</option>`).join("")}</select>

                  <button class=delete onclick="deleteConstraint('pin', ${e})">X</button>
		  `:t==="f2k"?n.innerHTML=`F2k <label>Arm Tip
                    <select name="reference" onchange="updateConstraint(this, 'f2k', ${e}, 'reference')">
            	   ${window.data.particles.map((a,i)=>i).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[e].reference?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    </label> <label>
		    Roller 
                    <select name="slider" onchange="updateConstraint(this, 'f2k', ${e}, 'slider')">

            	   ${window.data.particles.map((a,i)=>i).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[e].slider?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    </label> <label>
		    Arm Base
                    <select name="base" onchange="updateConstraint(this, 'f2k', ${e}, 'base')">

            	   ${window.data.particles.map((a,i)=>i).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[e].base?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    </label> <label>
		    One way
            			<input type="checkbox" oninput="window.data.constraints.f2k[${e}].oneway=this.checked;updateUI()" ${window.data.constraints.f2k[e].oneway?"checked":""}></input></label>
                  <button class=delete onclick="deleteConstraint('f2k', ${e})">X</button>
                `:t==="rope"&&(n.innerHTML=`
				Rope and pulley.
				<label>
				Fixed end:
				<select name="p1" onchange="updateConstraint(this, 'rope', ${e}, 'p1')">
								${window.data.particles.map((a,i)=>i).map(a=>`<option value="${a}" ${a===window.data.constraints.rope[e].p1?"selected":""}>P ${a+1}</option>`).join("")}
				</select></label>
${window.data.constraints.rope[e].pulleys.map((a,i)=>`
<label>Pulley
<select name="p2" onchange="updatePulley(this, ${e}, ${i})">

${window.data.particles.map((r,o)=>o).map(r=>`<option value="${r}" ${r===a.idx?"selected":""}>P ${r+1}</option>`).join("")}
</select>
<select onchange="updatePulleyDirection(this, ${e}, ${i})">
${["both","cw","ccw","cw_drop","ccw_drop"].map(r=>`<option value=${r} ${r==a.wrapping?"selected":""}>${r}</option>`).join("")}
</select></label>
`).join("")}
<button onclick="addPulley(${e})">+</button>
<button onclick="removePulley(${e})">-</button>
<label>Fixed end
<select name="p3" onchange="updateConstraint(this, 'rope', ${e}, 'p3')">

${window.data.particles.map((a,i)=>i).map(a=>`<option value="${a}" ${a===window.data.constraints.rope[e].p3?"selected":""}>P ${a+1}</option>`).join("")}
</select>
</label>
<button class=delete onclick="deleteConstraint('rope', ${e})">X</button>
<input type="checkbox" oninput="window.data.constraints.rope[${e}].oneway=this.checked;updateUI()" ${window.data.constraints.rope[e].oneway?"checked":""}></input>
`);n.addEventListener("mouseenter",()=>{window.data.constraints[t][e].hovered=!0,_()}),n.addEventListener("mouseleave",()=>{window.data.constraints[t][e].hovered=!1,_()}),document.getElementById("constraintsControl").appendChild(n)}let j=null;function Se(t,e){var n=window.data.particles.findIndex(a=>{const i=Math.sqrt((a.x-t)**2+(a.y-e)**2),r=Math.cbrt(a.mass)*10;return i<r});return n==-1&&(n=window.data.particles.findIndex(a=>{const i=Math.sqrt((a.x-t)**2+(a.y-e)**2),r=15+Math.cbrt(a.mass)*10;return i<r})),n}b.addEventListener("mousedown",function(t){const e=b.getBoundingClientRect(),n=b.width/e.width,a=b.height/e.height,i=(t.clientX-e.left)*n,r=(t.clientY-e.top)*a,o=Se(i,r);o!==-1?(j=o,b.style.cursor="move"):(startX=t.clientX-b.offsetLeft,startY=t.clientY-b.offsetTop)});b.addEventListener("mousemove",function(t){if(j!==null){const e=b.getBoundingClientRect(),n=b.width/e.width,a=b.height/e.height,i=(t.clientX-e.left)*n,r=(t.clientY-e.top)*a;window.data.particles[j].x=i,window.data.particles[j].y=r,_()}});b.addEventListener("mouseup",function(t){j!==null&&(C(),j=null,b.style.cursor="default")});b.addEventListener("mouseleave",function(t){j!==null&&(C(),j=null,b.style.cursor="default")});function Le(){localStorage.setItem("mechanismData",JSON.stringify(window.data))}function Ie(){const t=localStorage.getItem("mechanismData");if(t){window.data=JSON.parse(t),ve(window.data);try{C()}catch{fe({value:"Hinged Counterweight"})}}else fe({value:"Hinged Counterweight"})}window.addEventListener("resize",ye);window.onload=()=>{Ie(),ye(),fetch("https://apj.hgreer.com/jstreb",{method:"GET",cache:"no-store",mode:"no-cors"})};let re=!1;async function Mt(){if(re){re=!1,document.getElementById("optimize").innerText="Optimize";return}document.getElementById("optimize").innerText="Stop",re=!0;for(var t=500,e=t,n=40,a=+document.getElementById("range").innerText;re;){var i=JSON.stringify(window.data);for(var r of window.data.particles)Math.random()>.5&&(r.x%100!=0&&(r.x=r.x+n*(.5-Math.random())),r.y%100!=0?r.y=r.y+n*(.5-Math.random()):r.mass%1!=0&&(r.mass=Math.abs(r.mass+.001*n*(.5-Math.random()))));var[s,o,s,c]=Q();e%20==0&&await _e();var l=o;l>a?(e=t,a=o,_()):(window.data=JSON.parse(i),e-=1,e==0&&(e=t,n*=.6))}_()}let se=!1;async function Ct(){if(se){se=!1,document.getElementById("gentlify").innerText="Gentlify";return}document.getElementById("gentlify").innerText="Stop",se=!0;for(var t=500,e=t,n=40,a=+document.getElementById("range").innerText,i=+document.getElementById("peakLoad").innerText;se;){var r=JSON.stringify(window.data);for(var o of window.data.particles)Math.random()>.5&&(o.x%100!=0&&(o.x=o.x+n*(.5-Math.random())),o.y%100!=0?o.y=o.y+n*(.5-Math.random()):o.mass=Math.abs(o.mass+.001*n*(.5-Math.random())));var[c,s,c,l]=Q();e%20==0&&await _e();var p=l;console.log(p,l,s,a),!(p<i)||s<a?(window.data=JSON.parse(r),e-=1,e==0&&(e=t,n*=.6)):(e=t,i=l,_())}_()}function _t(){const t=new Blob([JSON.stringify(window.data)],{type:"application/json"}),e=prompt("Enter a filename for your window.data:","window.data.json");if(!e){alert("Save cancelled.");return}const n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}function kt(){const t=document.createElement("input");t.type="file",t.onchange=e=>{const n=e.target.files[0],a=new FileReader;a.onload=i=>{try{window.data=JSON.parse(i.target.result),ve(window.data),C()}catch{alert("Error parsing JSON!")}},a.readAsText(n)},document.body.appendChild(t),t.click(),document.body.removeChild(t)}window.doAnimate=wt;window.terminate=ge;window.drawMechanism=_;window.createParticle=ut;window.updateParticle=ft;window.deleteParticle=ht;window.createConstraint=mt;window.updateConstraint=bt;window.deleteConstraint=$t;window.resizeCanvas=ye;window.updateUI=C;window.loadPreset=fe;window.createParticleControlBox=Ee;window.constraintExists=le;window.createConstraintControlBox=Pe;window.getParticleAtPosition=Se;window.saveMechanism=Le;window.loadMechanism=Ie;window.optimize=Ct;window.optimizeRange=Mt;window.save=_t;window.load=kt;window.updatePulley=vt;window.updatePulleyDirection=gt;window.addPulley=xt;window.removePulley=yt;window.waitForAnimationFrame=ke;window.doit=dt;
